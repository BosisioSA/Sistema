<!doctype html>
<html>
    <head>
      <title>Novo Pedido de Vendas</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      
      <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/table.css">
        <meta name="viewport" content="width=944">
        <meta name="robots" content="noindex, follow">
	<link rel="Shortcut icon" href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/favicon.ico" type="image/x-icon">
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon.png" rel="apple-touch-icon" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144" />
        <link rel="stylesheet" href="fonts/fontawesome-all.min.css">
        <link rel="stylesheet" href="fonts/font-awesome.min.css">
        <link rel="stylesheet" href="fonts/fontawesome5-overrides.min.css">
        <script src="js/popper.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="/portal.cgi/PP_FILE_STORE/Sistema/assets/js/vendor/modernizr-2.6.2.min.js"></script>
      	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-1.8.3.min.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-ui-1.9.2.custom.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.cookie.js'></script>
    <!-- portal.js -->
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-linedtextarea.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/codemirror.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/javascript.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.tmpl.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-regex.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/sitemapstyler.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/date.format.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.iframe-transport.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.fileupload.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.notify.min.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.event.drag-2.2.js'></script>
        <script type='text/javascript' src='/portal.cgi?api=js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/portal/js/nixps-portal-api.js'></script>
        <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.i18n.js'></script>
        <script>
            var queryString = window.location.search;
            var ordem = decodeURI(queryString.substring(7,queryString.length))
        </script>
        <script>
          function pesquisacep(valor,campo) {
console.log(campo)
console.log(valor)
  //Nova variável "cep" somente com dígitos.
  var cep = valor.replace(/\D/g, '');

  //Verifica se campo cep possui valor informado.
  if (cep != "") {

      //Expressão regular para validar o CEP.
      var validacep = /^[0-9]{8}$/;

      //Valida o formato do CEP.
      if(validacep.test(cep)) {

          //Preenche os campos com "..." enquanto consulta webservice.
          document.getElementById('rua').value="Buscando...";
          document.getElementById('bairro').value="Buscando...";
          document.getElementById('cidade').value="Buscando...";
          document.getElementById('uf').value="Buscando...";
      
        var url_busca = "https://viacep.com.br/ws/"+cep+"/json/?"
        var busca_o_cep = api_sync.hub.start_from_whitepaper_with_files_and_variables("BUSCA_CEP","busca_cep", [] ,{"url":url_busca});
       
       
        var workable_id = busca_o_cep.workable_id
        var workableConsoleLog = function ()  // a cada 30s roda isso e atualiza a variavel form...
          {
            var variaveis = api.workable.get_merged_variables(workable_id)
           if (variaveis.variables.state.value == "buscando"){
      
          //Preenche os campos com "..." enquanto consulta webservice.
          document.getElementById('rua').value="Buscando...";
          document.getElementById('bairro').value="Buscando...";
          document.getElementById('cidade').value="Buscando...";
          document.getElementById('uf').value="Buscando...";
        
               
           } else {
              
          document.getElementById('rua').value=variaveis.variables.resultado.value.logradouro
          document.getElementById('bairro').value=variaveis.variables.resultado.value.bairro
          document.getElementById('cidade').value=variaveis.variables.resultado.value.localidade
          document.getElementById('uf').value=variaveis.variables.resultado.value.uf 
           
                  myStopFunction();
              }
        }
	   var workflowTimeout = setInterval(workableConsoleLog, 500);
        function myStopFunction() {
                    clearInterval(workflowTimeout);
                    }
        
       
        
          
        }
  }
      }
    
     </script>
       
    

    </head>


    <body>

  		<div class="wrapper d-flex align-items-stretch">
  			<nav id="sidebar">
  				<div class="p-4 pt-5">
            <img>
  		  		<img src="./assets/img/rotocrom.jpg" style="width: 70%; margin-bottom: 50px;">
              <ul class="active components mb-5">
                  <li style="color: #004b93; list-style-type: none">Pedidos
                  <ul>
                  <li class="active" style="list-style-type: none">
                     <a href="wizard_pedido.html?ordem="><i class="fas fa-cart-plus" style="margin-right: 5px"></i>Novo</a>
                    </li>
                    <li    style="list-style-type: none">
                     <a href="lista_pedidos.html"><i class="fas fa-tags" style="margin-right: 5px"></i>Meus Pedidos</a>
                    </li>
                   
                    </ul>
                    </li>
                    
                  
                    </ul>
       
   
  	        <div class="footer">
  	        	<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0.
  						  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
  						   Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
  	        </div>
  	      </div>
      	</nav>

          <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">

              <button type="button" id="sidebarCollapse" class="btn btn-primary">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
              </button>
              <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars"></i>
              </button>
              <div id="bemvindo" style="margin-left: 20px;"></div>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav ml-auto">
                 <!--<li class="nav-item">
                      <a class="nav-link" href="solicitacaoArtes.html">Nova Solicitação</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="DashBoard_aprovacoes.html">Dashboard</a>
                  </li>-->
                </ul>
              </div>
            </div>
          </nav>
          <div>
        <h2 id="titulo_pagina" style="display:inline-block;">Novo Pedido de Vendas</h2>
        <!--<div class="form-group col-md-2" style="display:inline-block;">
          <label for="data-inicio">A partir de</label>
          <input type="date"  onchange="preencheLista()" class="form-control" id="data-inicio" name="data-inicio">
        </div>
        <div class="form-group col-md-2" style="display:inline-block;">
          <label for="data-final">Ate</label>
          <input type="date"  onchange="preencheLista()" class="form-control" id="data-final" name="data-final">
        </div>-->
        
        <br>
       
        <br>
        <br>
        
        <div  class="form-group col-md-11" style="display:inline-block;">
        <hr>
       
            <div id="tipo_alteracao" style="display:none"></div>
            <div id="id_cliente" style="display:none"></div>
            
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="data-inicio">Data Entrada</label>
                <input type="date" class="form-control" id="data-inicio"  name="data-inicio" readonly>
            </div>
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="data-solicita">Data Solicitação</label>
                <input type="date" class="form-control" id="data-solicita"  name="data-solicita">
            </div>
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="especifica_servico">Especificação do Serviço</label>
                <select  class="form-control" id="especifica_servico" onchange="seleciona_servico()" name="especifica_servico">
                    <option value="undefined">Selecionar...</option>
                    </select>
            </div>
            <div id="mostra_referencias"  class="form-group col-md-11" style="display:none;"> 
            <br>
            <p>Preencha um dos campos para realizar a busca da referência </p>
          
            <div class="form-group col-md-3" style="display:inline-block; vertical-align: top;">
                <label for="numero_OP">Numero OP Anterior</label>
                <input type="text" class="form-control" id="numero_OP"  onfocusout="busca_referencia()"  name="numero_OP">
                 <span class="error"><p id="error_busca_OP" style="color:orange"></p></span>
            </div>
            <div class="form-group col-md-3" style="display:inline-block;  vertical-align: top;">
                <label for="codigo_fotografia">Código Fotografia</label>
                <input type="text" class="form-control" id="codigo_fotografia"  onfocusout="busca_referencia2()"  name="codigo_fotografia">
                 <span class="error"><p id="error_busca_fotografia" style="color:orange"></p></span>
            </div>
             <div class="form-group col-md-4" style="display:inline-block; vertical-align: top;">
                <label for="servico">Serviço</label>
                <input type="text" class="form-control" id="servico"  onfocusout="busca_referencia3()"  name="servico">
                 <span class="error"><p id="error_busca_servico" style="color:orange"></p></span>
                 
            </div>
            <div class="form-group col-md-1" style="display:inline-block; margin-top: 39px;">
             <img src="./assets/img/reload.png" width="20px" style="cursor:pointer; display:inline-block" onclick="abrecampos()">
             </div>
               
            
            </div>
            <hr>
           
           <h5 id="a_div_produto"><i id="produtoArrow" class="fas fa-chevron-right" onclick="mostraProduto()" style="margin-right: 5px; cursor:pointer;"></i>Informações do Produto</h5>
             <div id="info_produto" class="form-group col-md-11" style="display: none">
           
                <div class="form-group col-md-6" style="display:inline-block;">
                <label for="busca_cliente">Nome do Cliente</label>
                  <input type="text" class="form-control" style="display: inline-block; width: 80%; margin-right: 5px" id="busca_cliente"  onchange="verifica_cliente()" name="busca_cliente" list="os_clientes">
                  <span style="display: none;" onclick="cria_cliente()" id="imagem_adiciona_cliente">
                 <img src="./Icons/icone_mais.png" width="30px">
                </span>
                  <datalist id="os_clientes"></datalist>
                  <span class="error"><p id="error_busca_cliente" style="color:orange"></p></span>
                  </div>
                
                <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="sub_cliente">Sub Cliente</label>
                  <input type="text" class="form-control" id="sub_cliente"   name="sub_cliente">
                  </div>
                 <div class="form-group col-md-11" style="display:inline-block;">
                <label for="o_servico">Serviço</label>
                  <input type="text" class="form-control" id="o_servico" name="o_servico">
                  </div>
                 
                 <div class="form-group col-md-5" style="display:inline-block;">
                <label for="especifica_produto">Produto</label>
                <input type="text"  class="form-control" id="especifica_produto" onchange="verifica_produto()"  name="especifica_produto" list="os_produtos">
                    <datalist id="os_produtos"></datalist>
                     <span class="error"><p id="error_produto" style="color:orange"></p></span>
            </div>
            <div class="form-group col-md-5" style="display:inline-block;">
                <label for="especifica_material">Material</label>
                <input type="text"  class="form-control" id="especifica_material" onchange="verifica_material()" name="especifica_material" list="os_materiais">
                 <datalist id="os_materiais"></datalist>
                     <span class="error"><p id="error_materiais" style="color:orange"></p></span>  
            </div>
            <hr>
            </div>
            <h5 id="a_div_especificacao"><i id="especificacaoArrow" class="fas fa-chevron-right" onclick="mostraEspecificacao()" style="margin-right: 5px; cursor:pointer;"></i>Especificações Técnicas</h5>
             <div id="info_especificacao" class="form-group col-md-11" style="display: none">
           
             
            <br>
            <div class="form-group col-md-5" style="display:inline-block; vertical-align: top; border-right: 1px solid lightgray">
            <h6>Informação Material</h6>
            <div class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
                <label for="largura">Largura</label>
                  <input type="number" class="form-control" id="largura" name="largura">
                  </div>
            
            <div class="form-group col-md-11" style="display:inline-block;">
                <label for="especifica_ladoImpressao">Lado Impressão</label>
                <select  class="form-control" id="especifica_ladoImpressao"  name="especifica_ladoImpressao">
                    <option value="undefined">Selecionar...</option>
                    <option value="POR DENTRO">POR DENTRO</option>
                    <option value="POR FORA">POR FORA</option>
                    </select>
            </div>
           
            </div>
           
            <div class="form-group col-md-6" style="display:inline-block; vertical-align: top;">
              <h6>Informação Repetição</h6>  
        <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="faixas">Faixas</label>
                  <input type="number" class="form-control" onchange="calcula_largura()" id="faixas" name="faixas">
                  </div>
                   <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="medida_faixa">Medida Faixa</label>
                  <input type="number" class="form-control" onchange="calcula_largura()" id="medida_faixa" name="medida_faixa">
                  </div>
                  <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="entre_faixa">Entre Faixa</label>
                  <input type="number" class="form-control" onchange="calcula_largura()" id="entre_faixa" name="entre_faixa">
                  </div>
                  <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                   <label for="largura_total">Total</label>
                  <input type="text" class="form-control" id="largura_total" name="largura_total" readonly>
                  </div>
            </div>
         
            <hr>
            </div>
            <h5 id="a_div_cilindros"><i id="cilindrosArrow" class="fas fa-chevron-right" onclick="mostraCilindros()" style="margin-right: 5px; cursor:pointer;"></i>Cilindros</h5>
             <div id="info_cilindros" class="form-group col-md-11" style="display: none">
          
            
       
        <br>
        <span style="display: inline-block; cursor: pointer;" onclick="adiciona_tinta()">
                 <img src="./Icons/icone_mais.png" width="30px">
                </span>
        <div class="form-group" style="display:inline-block; width: 15%">
            <label for="cor">Cor</label>
            <input type="text" class="form-control" id="cor" name="cor" list="as_cores">
            <datalist id="as_cores"></datalist>
        </div>
        <div class="form-group" style="display:inline-block; width: 8%; margin-left: 17px;">
            <label for="numero">Número</label>
            <input type="text" class="form-control" id="numero" name="numero" onchange="preencheDadosCilindro()" list="codigos_cilindro">
            <datalist id="codigos_cilindro"></datalist>
        </div>
        <div class="form-group" style="display:inline-block; width: 8%; margin-left: 5px;">
            <label for="corpo">Corpo</label>
            <input type="number" class="form-control" id="corpo" name="corpo">
        </div>
        <div class="form-group" style="display:inline-block; width: 8%; margin-left: 14px;">
            <label for="perimetro">Perímetro</label>
            <input type="number" class="form-control" id="perimetro" name="perimetro">
        </div>
        
        <div class="form-group" style="display:inline-block; width: 12%; margin-left: 14px;">
            <label for="gravacao">Gravação</label>
            <select  class="form-control" id="gravacao" onchange="muda_gravacao()" name="gravacao">
                <option>Selecionar...</option>
                <option>ELETROMECÂNICA</option>
                <option>LASER</option>
                <option>MECÂNICA</option>
                </select>
        </div>
        <div id="mostra_profundidade" class="form-group" style="display:none">
            <label for="profundidade">Profundidade</label>
            <input type="number" class="form-control" id="profundidade" name="profundidade">
        </div>
        <div class="form-group" style="display:inline-block; width: 15%">
            <label for="tipo">Tipo</label>
            <select  class="form-control" id="tipo" name="tipo">
                <option>Selecionar...</option>
                <option value="CIC">Cilindro de Cobre</option>
                <option value="CIF">Cilindro de Ferro</option>
                <option value="CIM">Cilindro Mandril</option>
                <option value="CIB">Cilindro de Borracha</option>
                <option value="CAB">Camisa de Borracha</option>
                <option value="CAN">Camisa de Niquel</option>
                </select>
        </div>
        <div id="mostra_tabela_cilindros" class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
        <table id="tabelaCilindros" class="table table-sm" cellspacing="0" width="100%" style="display:inline-block;">
                <thead>
                  
                </thead>
                <tbody>
                    
                    <tr>
                    <th style="width: 25%">Cor
                    </th>
                    <th style="width: 8%">Numero
                    </th>
                     <th style="width: 9%">Corpo
                    </th>
                     <th style="width: 10%">Perímetro
                    </th>
                    <th style="width: 12%">Gravação
                    </th>
                     <th style="width: 10%">Profundidade
                    </th>
                    <th style="width: 5%">Tipo
                    </th>
                    <th style="width: 3%">Duplicar
                    </th>
                    <th style="width: 3%">Editar
                    </th>
                    <th style="width: 3%">Apagar
                    </th>
                    
                  </tr></tbody>
                </table>   
            
            
        </div>
        <hr>
        </div>
            
            
            
            <h5 id="a_div_fotocelula"><i id="fotocelulaArrow" class="fas fa-chevron-right" onclick="mostraFotocelula()" style="margin-right: 5px; cursor:pointer;"></i>Fotocélula e Tarja</h5>
             <div id="info_fotocelula" class="form-group col-md-11" style="display: none">
         
                
       <div class="form-group col-md-6" style="display:inline-block; vertical-align: top;">
            <h6>Fotocélula</h6>
            <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="largura_fotocelula">Largura</label>
                  <input type="number" class="form-control" id="largura_fotocelula" name="largura_fotocelula">
                  </div>
                  <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="altura_fotocelula">Altura</label>
                  <input type="number" class="form-control" id="altura_fotocelula" name="altura_fotocelula">
                  </div>
            <div class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
                <label for="qtde_fotocelula">Passo</label>
                <br>
                  <input type="number" class="form-control" style="width: 40%; display: inline-block; margin-right: 5px;" id="qtde_fotocelula" name="qtde_fotocelula"> x <input type="number" class="form-control"  style="width: 40%; display: inline-block; margin-left: 5px;" id="passo_fotocelula" name="passo_fotocelula">
            </div>
            
           
            <br>
            
            
            
            
            
            </div>
            
            <div class="form-group col-md-5" style="display:inline-block; vertical-align: top; border-left: 1px solid lightgray">
                <h6>Posição da Fotocélula</h6>
                <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                <label for="usar_print">Conforme Print</label>
                  <input type="checkbox" class="form-group" onclick="mostra_fotocelulas()" id="usar_print" name="usar_print">
                  </div>
                <div id="mostra_fotocelula1" style ="width: 100%">
                    <div style="height: 50px; margin-left: 50px; display: inline-block;">
                        
                    
                        <div style="width: 20px;display: inline-block; cursor: pointer">
                            <span id="90ES" onclick="adiciona_fotocelula()" style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 40px;display: inline-block;">
                        </div>
                        <div style="width: 20px;display: inline-block; ; cursor: pointer">
                            <span id="90CS" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 40px;display: inline-block;">
                        </div>
                         <div style="width: 20px;display: inline-block; ; cursor: pointer">
                            <span id="90DS" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 50px;display: inline-block;">
                        </div>
                </div>
            </div>
            <div id="mostra_fotocelula2" style="width: 100%">
            <div style ="width: 50px; height: 200px; display: inline-block;">
                <div style="width: 50px;display: inline-block; ; cursor: pointer">
                            <span id="0ES" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
                <div style="height 70px:width: 50px;display: inline-block;">
                    <span  style="margin-top:5px;height:50px;width:50px;background-color:#FAFAFA;display:inline-block">
                            </span>
                        </div>
               <div style="width: 50px;display: inline-block; ; cursor: pointer">
                            <span id="0EC" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
                <div style="height 70px:width: 50px;display: inline-block;">
                    <span  style="margin-top:5px;height:50px;width:50px;background-color:#FAFAFA;display:inline-block">
                            </span>
                        </div>
                <div style="width: 50px;display: inline-block;; cursor: pointer">
                            <span id="0EI" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
            </div>
            <div style ="width: 160px; height: 220px; display: inline-block; vertical-align: top;">
                <img src="./Icons/A.png" width="100%">
                </div>
            <div style ="width: 50px; height: 200px; display: inline-block;">
                <div style="width: 50px;display: inline-block;; cursor: pointer">
                            <span id="0DS" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
                <div style="height 70px:width: 50px;display: inline-block;">
                    <span  style="margin-top:5px;height:50px;width:50px;background-color:#FAFAFA;display:inline-block">
                            </span>
                        </div>
               <div style="width: 50px;display: inline-block;; cursor: pointer">
                            <span id="0DC" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
                <div style="height 70px:width: 50px;display: inline-block;">
                    <span  style="margin-top:5px;height:50px;width:50px;background-color:#FAFAFA;display:inline-block">
                            </span>
                        </div>
                <div style="width: 50px;display: inline-block;; cursor: pointer">
                            <span id="0DI" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:20px;width:50px;background-color:lightgray;display:inline-block">
                            </span>
                </div>
            </div>
            </div>
            <div id="mostra_fotocelula3" style="width: 100%">
                    <div style="height: 50px; margin-left: 50px; display: inline-block;">
                        
                    
                        <div style="width: 20px;display: inline-block;; cursor: pointer">
                            <span id="90EI" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 40px;display: inline-block;">
                        </div>
                        <div style="width: 20px;display: inline-block;; cursor: pointer">
                            <span id="90CI" onclick="adiciona_fotocelula()"  style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 40px;display: inline-block;">
                        </div>
                         <div style="width: 20px;display: inline-block;; cursor: pointer">
                            <span id="90DI" onclick="adiciona_fotocelula()" q style="margin-top:5px;height:50px;width:20px;background-color:lightgray;display:inline-block">
                            </span>
                        </div>
                        <div style="width: 50px;display: inline-block;">
                        </div>
                </div>
            </div>
            </div>
            
             <div class="form-group col-md-11" style="display:inline-block;">
            <h6>Cores Fotocélula</h6>
            <br>
            <div id="mostra_cor_fotocelula_1" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_1" for="a_cor_fotocelula_1"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_1" name="a_cor_fotocelula_1"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_1" name="a_pct_fotocelula_1">
                  <label  for="a_pct_fotocelula_1">%</label>
                  
            </div>
            <div id="mostra_cor_fotocelula_2" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_2" for="a_cor_fotocelula_2"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_2" name="a_cor_2_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_2" name="a_pct_fotocelula_2">
                  <label  for="a_pct_fotocelula_2">%</label>
            </div>
            <div id="mostra_cor_fotocelula_3" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_3" for="a_cor_fotocelula_3"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_3" name="a_cor_3_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_3" name="a_pct_fotocelula_3">
                  <label  for="a_pct_fotocelula_3">%</label>
            </div>
            <div id="mostra_cor_fotocelula_4" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_4" for="a_cor_fotocelula_4"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_4" name="a_cor_4_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_4" name="a_pct_fotocelula_4">
                  <label  for="a_pct_fotocelula_4">%</label>
            </div>
            <div id="mostra_cor_fotocelula_5" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_5" for="a_cor_fotocelula_5"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_5" name="a_cor_5_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_5" name="a_pct_fotocelula_5">
                  <label  for="a_pct_fotocelula_5">%</label>
            </div>
            <div id="mostra_cor_fotocelula_6" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_6" for="a_cor_fotocelula_6"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_6" name="a_cor_6_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_6" name="a_pct_fotocelula_6">
                  <label  for="a_pct_fotocelula_6">%</label>
            </div>
            <div id="mostra_cor_fotocelula_7" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_7" for="a_cor_fotocelula_7"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_7" name="a_cor_7_fotocelula"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_7" name="a_pct_fotocelula_7">
                  <label  for="a_pct_fotocelula_7">%</label>
            </div>
            <div id="mostra_cor_fotocelula_8" class="form-group col-md-3" style="display:none;">
                  <label id="label_cor_fotocelula_8" for="a_cor_fotocelula_8"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_8" name="a_cor_fotocelula_8"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_8" name="a_pct_fotocelula_8">
                  <label  for="a_pct_fotocelula_8">%</label>
            </div>
            <div id="mostra_cor_fotocelula_9" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_9" for="a_cor_fotocelula_9"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_9" name="a_cor_fotocelula_9"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_9" name="a_pct_fotocelula_9">
                  <label  for="a_pct_fotocelula_9">%</label>
            </div>
            <div id="mostra_cor_fotocelula_10" class="form-group" style="display:none;">
                  <label id="label_cor_fotocelula_10" for="a_cor_fotocelula_10"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_fotocelula()" id="a_cor_fotocelula_10" name="a_cor_fotocelula_10"><input type="number" class="form-group" style="width: 10%; display: none; margin-right: 5px;"  onchange="adiciona_pct_fotocelula()"   id="a_pct_fotocelula_10" name="a_pct_fotocelula_10">
                  <label  for="a_pct_fotocelula_10">%</label>
            </div>
            
        <hr>
        </div>
        <div class="form-group col-md-11" style="display:inline-block;">
            <h6>Tarja</h6>
            <br>
             <div class="form-group col-md-3" style="display:inline-block;">
                <label for="local_tarja">Local da tarja</label>
                <input type="text"  class="form-control" id="local_tarja"  name="local_tarja" list="os_locais">
                    <datalist id="os_locais"></datalist>
            </div>
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="medida_tarja">Medida (mm)</label>
                <input type="number"  class="form-control" id="medida_tarja"  name="medida_tarja"  value="0">
            </div>
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="tipo_registro">Tipo de Registro</label>
                <input type="text"  class="form-control" id="tipo_registro"  name="tipo_registro" list="os_registros">
                    <datalist id="os_registros"></datalist>
            </div>
            <div class="form-group col-md-2" style="display:inline-block;">
                
                <input type="checkbox"  class="form-group" id="logotipo"  name="logotipo">
                   <label for="logotipo">Logotipo</label>
            </div>
            <br>
             <h6>Cores Tarja</h6>
             <br>
             <div id="mostra_cor_tarja_1" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_1" for="a_cor_tarja_1"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_1" name="a_cor_tarja_1">
            </div>
            <div id="mostra_cor_tarja_2" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_2" for="a_cor_tarja_2"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_2" name="a_cor_tarja_2">
            </div>
            <div id="mostra_cor_tarja_3" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_3" for="a_cor_tarja_3"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_3" name="a_cor_tarja_3">
            </div>
            <div id="mostra_cor_tarja_4" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_4" for="a_cor_tarja_4"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_4" name="a_cor_tarja_4">
            </div>
            <div id="mostra_cor_tarja_5" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_5" for="a_cor_tarja_5"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_5" name="a_cor_tarja_5">
            </div>
            <div id="mostra_cor_tarja_6" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_6" for="a_cor_tarja_6"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_6" name="a_cor_tarja_6">
            </div>
            <div id="mostra_cor_tarja_7" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_7" for="a_cor_tarja_7"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_7" name="a_cor_tarja_7">
            </div>
            <div id="mostra_cor_tarja_8" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_8" for="a_cor_tarja_8"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_8" name="a_cor_tarja_8">
            </div>
            <div id="mostra_cor_tarja_9" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_9" for="a_cor_tarja_9"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_9" name="a_cor_tarja_9">
            </div>
            <div id="mostra_cor_tarja_10" class="form-group" style="display:none;">
                  <label id="label_cor_tarja_10" for="a_cor_tarja_10"></label>
                  <input type="checkbox" class="form-group" style="width: 5%; display: inline-block; margin-right: 5px;" onclick="adiciona_cor_tarja()" id="a_cor_tarja_10" name="a_cor_tarja_10">
            </div>
           
            <hr>
            <h6>Puxada</h6>
            <br>
            <div class="form-group col-md-3" style="display:inline-block;">
                <label for="valor_puxada">Puxada (mm)</label>
                <input type="number"  class="form-control" id="valor_puxada"  name="valor_puxada" step="0.01"  value="0.00">
            </div>
            <div id="mostra_puxada_cilindro" class="form-group col-md-4" style="display:inline-block;">
                <label for="qual_cilindro">Qual Cilindro</label>
                <select class="form-control" id="qual_cilindro"  name="qual_cilindro">
                    <option value="undefined">Selecionar Cilindro...</option>
                   </select>
            </div>
       <hr>
       </div>
       </div>
       <h5 id="a_div_codigoBarra"><i id="codigoBarraArrow" class="fas fa-chevron-right" onclick="mostraCodigoBarra()" style="margin-right: 5px; cursor:pointer;"></i>Códigos de Barra</h5>
             <div id="info_codigoBarra" class="form-group col-md-11" style="display: none">
         
    
        
        <div class="form-group col-md-6" style="display:inline-block;">
         <div class="form-group col-md-4" style="display:inline-block;">
                <label for="tipo_codigo">Tipo</label>
                <select  class="form-control" id="tipo_codigo"  name="tipo_codigo">
                    <option value="undefined">Selecionar...</option>
                    <option>EAN-13</option>
                    <option>QR-Code</option>
                    <option>UPC-A</option>
                    <option>UPC-E</option>
                    </select>
                    <span class="error"><p id="error_tipo_codigo_barra" style="color:red"></p></span>
            </div>
            <div class="form-group col-md-7" style="display:inline-block; vertical-align: top;">
                <label for="valor_codigo">Código</label>
                <input type="text"  class="form-control" id="valor_codigo"  name="valor_codigo">
                <span class="error"><p id="error_numero_codigo_barra" style="color:red"></p></span>
            </div>
            <div class="form-group col-md-11" style="display:inline-block;">
                <button class="btn btn-secondary" onclick="adiciona_codigo_barras()" style="cursor: pointer">Adicionar Código</button>
                </div>
                </div>
                <div class="form-group col-md-5" style="display:inline-block; vertical-align: top;">
                    
                <table id="tabelaCodigosBarra" class="table table-sm" cellspacing="0" width="100%" style="display:inline-block;">
                <thead>
                  
                </thead>
                <tbody>
                    
                    <tr>
                    <th style="width: 20%">Tipo
                    </th>
                    <th style="width: 70%">Código
                    </th>
                     <th style="width: 10%">Apagar
                    </th>
                    
                    
                    
                  </tr></tbody>
                </table>   
                    </div>
        
        <hr>
        </div>
       
      <!--<h5>Aprovação da Arte</h5>
       <br>
       <div class="form-group col-md-4" style="display:inline-block;">
                <label for="fluxo_aprovacao">Fluxo de Aprovação</label>
                <select  class="form-control" id="fluxo_aprovacao"  name="fluxo_aprovacao">
                    <option>Novo</option>
                    <option disabled="disabled">---------</option>
                    </select>
            </div>
        <div class="form-group col-md-2" style="display:inline-block;">
               
                <input type="checkbox" onchange="criar_novo_fluxo()" class="form-group" id="salvar_fluxo"  name="salvar_fluxo">
                 <label for="salvar_fluxo">Salvar Fluxo?</label>
            </div>
        <div id="mostra_nome_fluxo" class="form-group col-md-5" style="display:none;">
                <label for="nome_novo_fluxo">Nome do Fluxo</label>
                <input type="text" class="form-control" id="nome_novo_fluxo"  name="nome_novo_fluxo">
            </div>
            <br>
            <h6>Enviar para Aprovação</h6>
            <br>
            <div id="info_aprovador" style="display:none"></div>
            <div class="form-group col-md-2" style="display:inline-block;">
               
                <input type="checkbox" onchange="que_envia_aprovacao()" class="form-group" id="PDF"  name="PDF">
                 <label for="PDF">PDF</label>
            </div>
            <div class="form-group col-md-2" style="display:inline-block;">
               
                <input type="checkbox" onchange="que_envia_aprovacao()" class="form-group" id="JPG"  name="JPG">
                 <label for="JPG">JPG</label>
            </div>
            <div class="form-group col-md-2" style="display:inline-block;">
               
                <input type="checkbox" onchange="que_envia_aprovacao()" class="form-group" id="Prova Digital"  name="Prova Digital">
                 <label for="Prova Digital">Prova Digital</label>
            </div>
            <div class="form-group col-md-2" style="display:inline-block;">
               
                <input type="checkbox" onchange="que_envia_aprovacao()" class="form-group" id="Prova Cilindro"  name="Prova Cilindro">
                 <label for="Prova Cilindro">Prova Cilindro</label>
            </div>
            <br>
              <div  class="form-group col-md-6" style="display:inline-block; vertical-align: top;">
                 <div class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
                <label for="nome_aprovador">Nome Aprovador</label>
                <input type="text"  class="form-control" id="nome_aprovador"  name="nome_aprovador">
                 <span class="error"><p id="error_nome_aprovador" style="color:red"></p></span>
            </div> 
            <div class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
                <label for="email_aprovador">e-mail</label>
                <input type="text"  class="form-control" id="email_aprovador" onkeyup='this.value = this.value.toLowerCase()'  name="email_aprovador">
                 <span class="error"><p id="error_email_aprovador" style="color:red"></p></span>
            </div> 
            <button id="botao_incluir_aprovador" class="btn btn-secondary" onclick="adiciona_aprovadores()">Incluir Aprovador</button>
                  
                  </div>
                  <div  class="form-group col-md-5" style="display:inline-block; vertical-align: top">
                       <table id="tabelaAprovadores" class="table table-sm" cellspacing="0" width="100%" style="display:inline-block;">
                <thead>
                  
                </thead>
                <tbody>
                    
                    <tr>
                    <th style="width: 30%">Nome
                    </th>
                    <th style="width: 50%">e-mail
                    </th>
                    <th style="width: 10%">Editar
                    </th>
                     <th style="width: 10%">Apagar
                    </th>
                    
                    
                    
                  </tr></tbody>
                </table>   
                       
                       </div>-->
        
            
       
       
       
       
       <h5 id="a_div_anexos"><i id="anexosArrow" class="fas fa-chevron-right" onclick="mostraAnexos()" style="margin-right: 5px; cursor:pointer;"></i>Anexos Técnicos</h5>
             <div id="info_anexos" class="form-group col-md-11" style="display: none">
         
       <br>
       <a class="btn btn-secondary" style="display: none;" href="#" target="_Blank">Anexar Documentos</a>
       <br>
       <br>
       <br>
       <div id="mostra_tabela_documentos" class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
        <table id="tabelaDocumentos" class="table table-sm" cellspacing="0" width="100%" style="display:inline-block;">
                <thead>
                  
                </thead>
                <tbody>
                    
                    <tr>
                    <th style="width: 15%">Data Envio
                    </th>
                    <th style="width: 20%">Enviado por
                    </th>
                    <th style="width: 15%">Tipo
                    </th>
                     <th style="width: 40%">Nome Arquivo
                    </th>
                     <th style="width: 5%">Visualizar
                    </th>
                     <th style="width: 5%">Baixar
                    </th>
                    
                    
                  </tr></tbody>
                </table>   
            
            
        </div>
        <hr>
        </div>
        <h5 id="a_div_tarefas"><i id="tarefasArrow" class="fas fa-chevron-right" onclick="mostraTarefas()" style="margin-right: 5px; cursor:pointer;"></i>Tarefas</h5>
             <div id="info_tarefas" class="form-group col-md-11" style="display: none">
         

       <br>
       <div class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
           <div class="form-group col-md-4" style="display:inline-block; vertical-align: top;">
                <label for="tarefa_departamento">Departamento</label>
                <select  class="form-control" id="tarefa_departamento"  name="tarefa_departamento">
                    <option>Selecionar</option>
                    <option>Inspeção</option>
                    <option>Galvano</option>
                    <option>Prepress</option>
                    <option>Gravação</option>
                    <option>Faturamento</option>
                    <option>Despacho</option>
                    </select>
            </div>
            <div class="form-group col-md-7" style="display:inline-block; vertical-align: top;">
                <label for="tarefa_descricao">Descrição</label>
                <textarea  class="form-control" id="tarefa_descricao"  name="tarefa_descricao" cols="1" rows="5">
                    </textarea>
            </div>
            <button class="btn btn-secondary" onclick="adiciona_tarefa()" style="cursor: pointer">Adicionar Tarefa</button>
           
           </div>
           
           <div  class="form-group col-md-11" style="display:inline-block; vertical-align: top;">
        <table id="tabelaTarefas" class="table table-sm" cellspacing="0" width="100%" style="display:inline-block;">
                <thead>
                  
                </thead>
                <tbody>
                    
                    <tr>
                    <th style="width: 20%">Criada em
                    </th>
                    <th style="width: 15%">Criada por
                    </th>
                    <th style="width: 20%">Departamento
                    </th>
                     <th style="width: 40%">Descrição
                    </th>
                     <th style="width: 5%">Apagar
                    </th>
                    
                    
                  </tr></tbody>
                </table>   
          
            
        </div>
        <hr>
       
       </div>
                <br>
                <section class="form-group col-md-7" style="display: inline-block;"></section>
                 <div  class="form-group col-md-1" style="display:inline-block; vertical-align: top;">
                <button id="fecha" class="btn btn-primary" onclick="window.close()" style="cursor: pointer">Fechar</button>
                </div>
                <div  class="form-group col-md-2" style="display:inline-block; vertical-align: top;">
                <button id="salva_cliente" class="btn btn-primary" onclick="grava_pedido()" style="cursor: pointer">Salvar Pedido</button>
                </div>
                 <div id="info_update" style="color: green"></div>
                 
              
            </div>
        
       
  	
  		
  	<script>
  	// funcoes auxiliares
  	
    function clearTable(table) {
  var rows = table.rows;
  var i = rows.length;
  while (--i) {
    rows[i].parentNode.removeChild(rows[i]);
    // or
    // table.deleteRow(i);
  }
}	
  	
function onlyUnique(value, index, self) {
  return self.indexOf(value) === index;
}

  	    //preenche select do cliente
  	    
  	     var listaCodigo2 = api.custom_objects.list_with_options("BR-ROTOC_customers",[],[],["FANTASIA"]).results;
          var options=''; // variable to store the options
          for(var i = 0; i < listaCodigo2.length; i++){
              
          options += '<option value="'+listaCodigo2[i].FANTASIA+'" />';
  
          }
           document.getElementById('os_clientes').innerHTML = options;
  	   
  	   
  	   
    var tiposTipo2 = api.custom_objects.list_with_options("BR-ROTOC_tiposGravacao",[],[],["tipo"]).results
    var nomes_grupo2 = new Array()
    
//    for (i=0;i<tiposTipo2.length;i++){
  //      nomes_grupo2.push(tiposTipo2[i].tipo)
//    }
    
 //   var nomes_limpos2 = nomes_grupo2.filter(onlyUnique)
  //  for (var i = 0; i<nomes_limpos2.length; i++){
    //    if (nomes_limpos2[i] != "CILINDRO DE MANDRIL"){
    //    var opt = document.createElement('option');
    //    opt.value = nomes_limpos2[i];
    //    opt.innerHTML = nomes_limpos2[i];
    //    selectTipo2.appendChild(opt);
    //    }
//    }
  	   
  	   // preenche opções de local
  	   
  	    var listalocais = api.custom_objects.list_with_options("TBLLOCAIS",[],[],["DESCRICAO"]).results;
          var options_locais=''; // variable to store the options
          for(var i = 0; i < listalocais.length; i++){
              
          options_locais += '<option value="'+listalocais[i].DESCRICAO+'" />';
  
          }
           document.getElementById('os_locais').innerHTML = options_locais;
           
            var listaregistro = api.custom_objects.list_with_options("TBLREGISTRO",[],[],["DESCRICAO"]).results;
          var options_registro=''; // variable to store the options
          for(var i = 0; i < listaregistro.length; i++){
              
          options_registro += '<option value="'+listaregistro[i].DESCRICAO+'" />';
  
          }
           document.getElementById('os_registros').innerHTML = options_registro;
  	   
  	</script>
  	
  	<script>
  	    
  	    // preenche selects
  	    
//  	     selectFinalidade = document.getElementById('finalidade');
    var tiposFinalidade = api.custom_objects.list_with_options("BR-ROTOC_especificacaoServico").results
    
    
      selectServico = document.getElementById('especifica_servico');
 //   var tiposServico = api.custom_objects.list_with_options("BR-ROTOC_finalidade").results
   // for (var i = 0; i<tiposServico.length; i++){
//        var opt = document.createElement('option');
//        opt.value = tiposServico[i].servico;
//        opt.innerHTML = tiposServico[i].servico;
  //      selectFinalidade.appendChild(opt);
//    }
    for (var i = 0; i<tiposFinalidade.length; i++){
        var opt = document.createElement('option');
        opt.value = tiposFinalidade[i].servico;
        opt.innerHTML = tiposFinalidade[i].servico;
        selectServico.appendChild(opt);
    }
    
    
    
    
  	    
  	</script>
  	
  	
  	<script>
  	    
  	    // Funcoes Colapse
  	    
  
      function mostraProduto(){
         
        var div_cliente = document.getElementById("info_produto")
        var icone = document.getElementById("produtoArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
      function mostraEspecificacao(){
         
        var div_cliente = document.getElementById("info_especificacao")
        var icone = document.getElementById("especificacaoArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
       function mostraCilindros(){
         
        var div_cliente = document.getElementById("info_cilindros")
        var icone = document.getElementById("cilindrosArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
      
       function mostraFotocelula(){
         
        var div_cliente = document.getElementById("info_fotocelula")
        var icone = document.getElementById("fotocelulaArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
      
       function mostraCodigoBarra(){
         
        var div_cliente = document.getElementById("info_codigoBarra")
        var icone = document.getElementById("codigoBarraArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
      
       function mostraAnexos(){
         
        var div_cliente = document.getElementById("info_anexos")
        var icone = document.getElementById("anexosArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }
      
      
       function mostraTarefas(){
         
        var div_cliente = document.getElementById("info_tarefas")
        var icone = document.getElementById("tarefasArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            } else {
                div_cliente.style.display = "none";
            }
       
      }

  	    
  	    
  	</script>
  	
  	<script>
  	    // preenche dados do pedido
  	    
  	    var busca_ID = api.custom_objects.list_with_options("BR-ROTOC_pedidos",["_id","equal to",ordem]).results[0]
  	    
  	    
  	    
  	    var selectPuxada = document.getElementById('qual_cilindro');
  	    var o_num_cil = 0
    for (var i = 0; i<busca_ID.separacoes.length; i++){
        if (busca_ID.separacoes[i].mesmo_cilindro === false){
        var o_num_cil = o_num_cil+1
        var nome = busca_ID.separacoes[i].cor
        var opt = document.createElement('option');
        opt.value =  o_num_cil;
        opt.innerHTML = o_num_cil+" - "+nome;
        selectPuxada.appendChild(opt);
        }
    }
    
  	    
  	    document.getElementById("titulo_pagina").innerText = "Edição do pedido "+busca_ID.codigo_pedido
  	    
  	    var a_data_inicio = new Date(busca_ID.info_geral.data_entrada)
  	    var data_inicio_ok = dateFormat(a_data_inicio,"yyyy-mm-dd")
  	    document.getElementById("data-inicio").value = data_inicio_ok
  	     var a_data_solicita = new Date(busca_ID.info_geral.data_solicitacao)
  	    var data_solicita_ok = dateFormat(a_data_solicita,"yyyy-mm-dd")
  	    document.getElementById("data-solicita").value = data_solicita_ok
  	    
  	    document.getElementById("busca_cliente").value = busca_ID.info_geral.nome_cliente.FANTASIA
  	    document.getElementById("sub_cliente").value  = busca_ID.info_geral.sub_cliente
  	    document.getElementById("servico").value = busca_ID.info_geral.servico
  	     document.getElementById("o_servico").value = busca_ID.info_geral.servico
  	    document.getElementById("especifica_produto").value = busca_ID.info_geral.produto
  	    document.getElementById("especifica_material").value = busca_ID.info_geral.material
  	    document.getElementById("largura").value = busca_ID.info_embalagem.largura_material
  	    document.getElementById("faixas").value = busca_ID.info_embalagem.faixas
  	    document.getElementById("medida_faixa").value = busca_ID.info_embalagem.medida_faixa
  	    document.getElementById("largura_total").value = busca_ID.info_embalagem.largura_total
  	    var os_cilindros = busca_ID.separacoes
  	    document.getElementById("largura_fotocelula").value = busca_ID.fotoc_tarja.largura_fotocelula
  	    document.getElementById("altura_fotocelula").value = busca_ID.fotoc_tarja.altura_fotocelula
  	    document.getElementById("qtde_fotocelula").value = busca_ID.fotoc_tarja.qtde_fotocelula
  	    document.getElementById("passo_fotocelula").value = busca_ID.fotoc_tarja.passo_fotocelula
  	    document.getElementById("local_tarja").value = busca_ID.fotoc_tarja.local_tarja
  	    document.getElementById("medida_tarja").value = busca_ID.fotoc_tarja.medida_tarja
  	    document.getElementById("tipo_registro").value = busca_ID.fotoc_tarja.tipo_registro
  	    document.getElementById("valor_puxada").value = busca_ID.puxada.valor
  	    
  	    var selectPuxada = document.getElementById("qual_cilindro")
  	    
  	    for (i=0;i<selectPuxada.options.length;i++){
  	        if (selectPuxada.options[i].value == busca_ID.puxada.qual_cilindro){
  	            selectPuxada.selectedIndex = i
  	        }
  	    }
  	    
  	    
  	    var selectTipo = document.getElementById("especifica_servico")
  	    
  	    for (i=0;i<selectTipo.options.length;i++){
  	        if (selectTipo.options[i].value == busca_ID.info_geral.tipo_servico){
  	            selectTipo.selectedIndex = i
  	        }
  	    }
  	    
  	    if (busca_ID.info_geral.tipo_servico != "NOVO"){
  	        document.getElementById("mostra_referencias").style = "display: inline-block;"
  	        document.getElementById("codigo_fotografia").value = busca_ID.info_geral.codigo_fotografia
  	        document.getElementById("numero_OP").value = busca_ID.info_geral.op_anterior
  	    }
  	    
  	    var selectTipo2 = document.getElementById("especifica_ladoImpressao")
  	    
  	    for (i=0;i<selectTipo2.options.length;i++){
  	        if (selectTipo2.options[i].value == busca_ID.info_embalagem.especifica_ladoImpressao){
  	            selectTipo2.selectedIndex = i
  	        }
  	    }
  	    
  	    
  	    var os_codigos_barra = busca_ID.codigos_barra
  	    
  	    
  	     for (i=0;i<busca_ID.fotoc_tarja.posicao_fotocelula.length;i++){
            var div_pos_foto = busca_ID.fotoc_tarja.posicao_fotocelula[i]
            if (div_pos_foto == '90ES' || div_pos_foto == '90CS'|| div_pos_foto == '90DS' || div_pos_foto == '90EI' || div_pos_foto ==  '90CI'|| div_pos_foto == '90DI'){
            document.getElementById(div_pos_foto).style = "margin-top: 5px; height: 50px; width: 20px; background: black; display: inline-block;"
            } else {
               document.getElementById(div_pos_foto).style = "margin-top: 5px; height: 20px; width: 50px; background: black; display: inline-block;"
            }
        }
        var fotocelulas = busca_ID.fotoc_tarja.posicao_fotocelula
        
        
         for (i=0;i<os_cilindros.length;i++){
  	            
  	        var numero_fotocelula = i+1
  	        var mostra_cor = "mostra_cor_fotocelula_"+numero_fotocelula
  	         var label_cor = "label_cor_fotocelula_"+numero_fotocelula
  	         var check_cor = "a_cor_fotocelula_"+numero_fotocelula
  	         var pct_cor = "a_pct_fotocelula_"+numero_fotocelula
  	         
  	         var mostra_cor_tarja = "mostra_cor_tarja_"+numero_fotocelula
  	         var label_cor_tarja = "label_cor_tarja_"+numero_fotocelula
  	         var check_cor_tarja = "a_cor_tarja_"+numero_fotocelula
  	         
  	         document.getElementById(mostra_cor).style = "display: inline-block; width: 30%"
  	         document.getElementById(label_cor).innerText = os_cilindros[i].cor
  	                 if (os_cilindros[i].fotocelula === true){
  	                 document.getElementById(check_cor).checked = true
  	                  document.getElementById(pct_cor).value = os_cilindros[i].pct_fotocelula
  	                  document.getElementById(pct_cor).style = "display: inline-block; width: 20%"
  	                 } else {
  	                  
  	                  os_cilindros[i].pct_fotocelula = 100
  	                 }
  	                 
  	                  document.getElementById(mostra_cor_tarja).style = "display: inline-block; width: 30%"
  	                  document.getElementById(label_cor_tarja).innerText = os_cilindros[i].cor
  	                 document.getElementById(check_cor_tarja).checked = os_cilindros[i].tarja
  	                
  	                 
  	             }
  	             
  	      
  	         
  	         
  	         
  	    
  	</script>
  	
  	
  	
  	<script>
  	    function mostra_fotocelulas(){
  	        if (document.getElementById("usar_print").checked === true){
  	            document.getElementById("mostra_fotocelula1").style = "display:none"
  	            document.getElementById("mostra_fotocelula2").style = "display:none"
  	            document.getElementById("mostra_fotocelula3").style = "display:none"
  	        } else {
  	             document.getElementById("mostra_fotocelula1").style = "display:inline-block;"
  	            document.getElementById("mostra_fotocelula2").style = "display:inline-block;"
  	             document.getElementById("mostra_fotocelula3").style = "display:inline-block;"
  	        }
  	        
  	    }
  	    
  	    
  	    function adiciona_fotocelula(){
  	         var linha = event.srcElement.id
  	         console.log(linha)
  	        var existe = false
  	        for (i=0;i<fotocelulas.length;i++){
  	            if (fotocelulas[i] == linha){
  	                existe = true
  	            }
  	        }
  	        
  	        console.log(existe)
  	        if (existe === false){
  	            var objeto = document.getElementById(linha)
                 objeto.style.background = "black"
                 fotocelulas.push(linha)
  	        } else {
  	            for (i=0;i<fotocelulas.length;i++){
  	                if (fotocelulas[i] == linha){
  	                    var tira = fotocelulas.splice(i,1)
  	                    var objeto = document.getElementById(linha)
                 objeto.style.background = "lightgray"
  	                    
  	                }
  	            }
  	        }
  	        
  	        
  	        
  	    }
  	    
  	    
  	    function adiciona_cor_fotocelula(){
  	        
  	        var linha = event.srcElement.id
  	        var mostra_cor = linha.replace("cor","pct")
  	         var label_cor = linha.replace("a","label")
  	         console.log(linha)
  	         
  	         document.getElementById(mostra_cor).style = "display: inline-block;"
  	         var existe = false
  	         for (i=0;i<os_cilindros.length;i++){
  	             if (os_cilindros[i].cor == document.getElementById(label_cor).innerText){
  	                 if (document.getElementById(linha).checked === true){
  	                  os_cilindros[i].fotocelula = true  
  	                  os_cilindros[i].pct_fotocelula = document.getElementById(mostra_cor).value
  	                 } else {
  	                  os_cilindros[i].fotocelula = false
  	                  os_cilindros[i].pct_fotocelula = 0
  	                 }
  	                 
  	             }
  	         }
  	         
  	             
  	         preencheCoresFotocelula()
  	        
  	    }
  	    
  	    
  	    
  	    
  	    
  	    function adiciona_pct_fotocelula(){
  	       var linha = event.srcElement.id
  	        var thelabel = linha.replace("a_pct","label_cor")
  	        console.log(thelabel)
  	        console.log(document.getElementById(thelabel).innerText)
  	        for (i=0;i<cores_fotocelula.length;i++){
  	            if (cores_fotocelula[i].cor == document.getElementById(thelabel).innerText){
  	                cores_fotocelula[i].pct = parseFloat(document.getElementById(linha).value)
  	            }
  	        }
  	          
  	    }
  	    
  	    
  	    function adiciona_cor_tarja(){
  	        
  	        var linha = event.srcElement.id
  	         var label_cor = linha.replace("a","label")
  	         
  	         console.log(linha)
  	         for (i=0;i<os_cilindros.length;i++){
  	             if (os_cilindros[i].cor == document.getElementById(label_cor).innerText){
  	                 if (document.getElementById(linha).checked === true){
  	                 os_cilindros[i].tarja = true
  	                 } else {
  	                    os_cilindros[i].tarja = false  
  	                 }
  	             }
  	         }
  	      preencheCoresFotocelula()  
  	    }
  	    
  	    
  	    
  	</script>
  	<script>
  	    function selecionar_cliente(){
  	        var sel_codigo = document.getElementById("codigo_cliente").value
  	            
  	            if (sel_codigo == "undefined"){
  	                document.getElementById("mostra_cliente").style = "display: none"
  	            }
  	            if (sel_codigo == "new"){
  	                document.getElementById("mostra_cliente").style = "display: inline-block"
  	            } else {
  	                document.getElementById("mostra_cliente").style = "display: none"
  	            }
  	               
  	           
  	        }
  	        
  	        function seleciona_cilindro(){
  	            var qual_cilindro = document.getElementById("tipo_produto").value
  	            
  	            if(qual_cilindro != "undefined"){
  	                
  	                $('#tipo_gravacao option:not(:first)').remove();

  	                document.getElementById("mostra_tipo_gravacao").style = "display: inline-block;"
  	                var busca_cilindros = api.custom_objects.list_with_options("BR-ROTOC_tiposGravacao",["tipo","equal to",qual_cilindro]).results
  	                
  	                 selectTipoGravacao = document.getElementById('tipo_gravacao');
                 
                     var nomes_gravacao = new Array()
    
                    for (i=0;i<busca_cilindros.length;i++){
                        nomes_gravacao.push(busca_cilindros[i].subtipo)
                    }
    
                    for (var i = 0; i<nomes_gravacao.length; i++){
                        var opt = document.createElement('option');
                        opt.value = nomes_gravacao[i];
                        opt.innerHTML = nomes_gravacao[i];
                        selectTipoGravacao.appendChild(opt);
                    }
                  	                
  	            } else {
  	               document.getElementById("mostra_tipo_gravacao").style = "display: none;" 
  	            }
  	            
  	            
  	        }
  	    
  	</script>
  	<script>
  	    
  	        
  	    
  	</script>
  		  
  		  
  

      <script>
      
      
      var usuario = api.auth.get_current_user()
      var nome_user = "Bem vindo, "+usuario.fullname
      document.getElementById("bemvindo").innerText = nome_user
      </script>
      <script>
        function array_move(arr, old_index, new_index) {
    if (new_index >= arr.length) {
        var k = new_index - arr.length + 1;
        while (k--) {
            arr.push(undefined);
        }
    }
    arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);
    return arr; // for testing
};

    </script>
      
    <script>
    
    var tintas = api.custom_objects.list_with_options("PantoneColor",[],[],["nome"]).results;
        var options2=''; // variable to store the options
        for(var i = 0; i < tintas.length; i++){
            
        options2 += '<option value="'+tintas[i].nome+'" />';

        }
         document.getElementById('as_cores').innerHTML = options2;
         
         
    var produtos = api.custom_objects.list_with_options("TBLPRODUTO",[],[],["DESCRICAO"]).results;
        var options3=''; // variable to store the options
        for(var i = 0; i < produtos.length; i++){
            
        options3 += '<option value="'+produtos[i].DESCRICAO+'" />';

        }
         document.getElementById('os_produtos').innerHTML = options3;
         
         
     var materiais = api.custom_objects.list_with_options("TBLMATERIAIS",[],[],["DESCRICAO"]).results;
        var options4=''; // variable to store the options
        for(var i = 0; i < materiais.length; i++){
            
        options4 += '<option value="'+materiais[i].DESCRICAO+'" />';

        }
         document.getElementById('os_materiais').innerHTML = options4;
    if (os_cilindros === undefined){
    var os_cilindros = []
    }
    
    
    function preencheCoresFotocelula(){
            for (i=0;i<10;i++){
            
            
            var numero = i+1
            var mostrar = "mostra_cor_fotocelula_"+numero
            var mostrar2 = "mostra_cor_tarja_"+numero
            
            var olabel = "label_cor_fotocelula_"+numero
            var olabel2 = "label_cor_tarja_"+numero
            
            var ovalor = "a_pct_fotocelula_"+numero
            var ocheck = "a_cor_fotocelula_"+numero
            var ocheck2 = "a_cor_tarja_"+numero
            console.log(mostrar)
            console.log(olabel)
            console.log(ocheck)
            console.log(ovalor)
            if (i<os_cilindros.length){
            document.getElementById(mostrar).style = "display: inline-block; width: 33%"
            document.getElementById(mostrar2).style = "display: inline-block; width: 25%"
            document.getElementById(olabel).innerText = os_cilindros[i].cor
            document.getElementById(olabel2).innerText = os_cilindros[i].cor
            document.getElementById(ocheck).checked = os_cilindros[i].fotocelula
            document.getElementById(ocheck2).checked = os_cilindros[i].tarja
            document.getElementById(ovalor).value = os_cilindros[i].pct_fotocelula
            if (os_cilindros[i].fotocelula == false){
                document.getElementById(ovalor).style = "display: none;"
            }
                
            } else {
            document.getElementById(mostrar).style = "display: none;"
            document.getElementById(mostrar2).style = "display: none;"
            document.getElementById(olabel).innerText = ""
            document.getElementById(olabel2).innerText = ""
            document.getElementById(ocheck).checked = false
            document.getElementById(ocheck2).checked = false
            document.getElementById(ovalor).value = 0
            document.getElementById(ovalor).style = "display: none."
            
             }
             
            
             }
            
        
        
    } 
        
    
    
    
        function adiciona_tinta(){
            var busca_tinta = api.custom_objects.list_with_options("PantoneColor",["nome","equal to",document.getElementById("cor").value]).results
            if (busca_tinta.length == 0){
                var acor_hex = "#EEEEEE"
            } else {
                var acor_hex = busca_tinta[0].cor
            }
            var data = {}
            data["numero"] = document.getElementById("numero").value
            data["cor"] = document.getElementById("cor").value
            data["hex"] = acor_hex
            data["lineatura"] = 0
            data["angulo"] = 0
            data["corpo"] = document.getElementById("corpo").value
            data["perimetro"] = document.getElementById("perimetro").value
            data["profundidade"] = document.getElementById("profundidade").value
            data["gravacao"] = document.getElementById("gravacao").value
            data["tipo"] = document.getElementById("tipo").value
            data["fotocelula"] = false
            data["pct_fotocelula"] = 100
            data["tarja"] = false
            data["mesmo_cilindro"] = false
            
            if (data["gravacao"] == "Selecionar..."){
                
            } else {
                var existe = false
                
                for (i=0;i<os_cilindros.length;i++){
                    console.log("Compararand")
                    console.log(data["cor"])
                    console.log("com")
                    console.log(os_cilindros[i].cor)
                    if (data["cor"] == os_cilindros[i].cor){
                        console.log()
                        existe = true
                        var indice = i
                    }
                }
                console.log("Existe "+existe)
                if (existe === false){
                os_cilindros.push(data)
                }
                else {
                    os_cilindros[indice].numero = document.getElementById("numero").value
                    os_cilindros[indice].lineatura = 0
                    os_cilindros[indice].angulo = 0
                    os_cilindros[indice].corpo = document.getElementById("corpo").value
                    os_cilindros[indice].perimetro = document.getElementById("perimetro").value
                    os_cilindros[indice].gravacao = document.getElementById("gravacao").value
                    os_cilindros[indice].tipo = document.getElementById("tipo").value
                }
            }
            
            
            
               var chaves = Object.keys(data)
               
               for (k=0;k<chaves.length;k++){
                   if (chaves[k] == "hex"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "fotocelula"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "pct_fotocelula"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "tarja"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "mesmo_cilindro"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "angulo"){
                       var tira = chaves.splice(k,1)
                   }
                   if (chaves[k] == "lineatura"){
                       var tira = chaves.splice(k,1)
                   }
               }
               
               for (y=0;y<chaves.length;y++){
                    if (chaves[y] == "angulo"){
                        var tira = chaves.splice(y,1)
                    }
                }
               console.log(chaves.toString())
               for (j=0;j<chaves.length;j++){
                   
                       if (chaves[j] != "gravacao" || chaves[j] != "tipo" || chaves[j] != "angulo"){
                   document.getElementById(chaves[j]).style = "border-color:#ced4da ; background-color: white;"
              document.getElementById(chaves[j]).value = ""
                       }
                      else {
                           document.getElementById(chaves[j]).style = "border-color:#ced4da ; background-color: white;"
              document.getElementById(chaves[j]).value = "Selecionar..." 
                       }
                   }
               
              
              
           
            preencheTabelaCilindros()
            
            
        }
        
       var numero_cilindro = 0

            function preencheTabelaCilindros(){
         
         var table = document.getElementById("tabelaCilindros")
        clearTable(table)
        var qtasrow = table.rows.length
      
       
        
            
        for (i=0;i<os_cilindros.length;i++){
           
            // preenche as cores da fotocelula
            
          
            
            
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            var cell9 = row.insertCell(8);
            var cell10 = row.insertCell(9);
            
            if (os_cilindros[i].profundidade == ""){
                os_cilindros[i].profundidade = "N/A"
            }
         
          if (os_cilindros[i].mesmo_cilindro == true){
              numero_cilindro = numero_cilindro
          } else {
              numero_cilindro = numero_cilindro+1
          }
            if (os_cilindros[i].mesmo_cilindro == false){
            cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"><div style="display:inline-block"><i onclick="move_acima()" id="'+i+'" class="fas fa-arrow-up" style="margin-right: 5px; cursor: pointer;"></i><i  onclick="move_abaixo()" id="'+i+'" class="fas fa-arrow-down" style="margin-right: 5px;cursor: pointer;"></i><span style="margin-top:5px;height:20px;width:20px;background-color:'+os_cilindros[i].hex+';border-radius:50%;display:inline-block"></span></div><span style="display: inline-block;"></span></div><strong> '+numero_cilindro+' - '+os_cilindros[i].cor+'</strong></div>'
            } else {
             cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"><div style="display:inline-block"><i  id="'+i+'" class="fas fa-times-circle" style="margin-right: 5px;"></i><i  id="'+i+'" class="fas fa-times-circle" style="margin-right: 5px;"></i><span style="margin-top:5px;height:20px;width:20px;background-color:'+os_cilindros[i].hex+';border-radius:50%;display:inline-block"></span></div><span style="display: inline-block;"></span></div><strong> '+numero_cilindro+' - '+os_cilindros[i].cor+'</strong></div>'
                
            }
            cell2.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].numero+'</div>'
            cell3.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].corpo+'</div>'
            cell4.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].perimetro+'</div>'
            cell5.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].gravacao+'</div>'
            cell6.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].profundidade+'</div>'
            cell7.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_cilindros[i].tipo+'</div>'
            cell8.innerHTML = '<div style="font-size: 1em; display: inline-block; cursor: pointer;"  ><img id="'+i+'" src="./Icons/duplicar.png" width="30px" onclick="duplicar_cilindro()"></div>'
            cell9.innerHTML = '<div style="font-size: 1em; display: inline-block; cursor: pointer;"  ><img id="'+os_cilindros[i].cor+'" src="./Icons/Edit.png" width="30px" onclick="editar_cilindro()"></div>'
            cell10.innerHTML = '<div style="font-size: 1em; display: inline-block; cursor: pointer;" ><img id="'+os_cilindros[i].cor+'" src="./Icons/delete.png" width="30px" onclick="apagar_cilindro()"></div>'
         
            qtasrow = qtasrow +1
         
        }    
           
         numero_cilindro = 0
         verifica_cliente()
        }
        
        function move_acima(){
             var linha = parseInt(event.srcElement.id)
       console.log(linha)
        var mover = []
       var outras = []
       
       if (os_cilindros[linha].mesmo_cilindro === false){
       var nome_cor = os_cilindros[linha].cor
       var eh_igual = new RegExp(".*"+nome_cor+".*")
       for (i=linha;i<os_cilindros.length;i++){
           if (eh_igual.test(os_cilindros[i].cor) === true){
               mover.push([os_cilindros[i],i])
           } 
           
       }
       for (i=0;i<linha;i++){
           
               outras.push([os_cilindros[i],i])
           
           
       }
       }
       
       outras = outras.reverse()
       
       var encontra_proxima = []
       
       for (i=0;i<outras.length;i++){
           if (outras[i][0].mesmo_cilindro === false){
               encontra_proxima.push(outras[i])
           }
       }
       
       var busca_ultima = encontra_proxima[0][1]
       
       
       for (i=0;i<mover.length;i++){
        if (linha > 0){
   
            var linha_final = busca_ultima+i
            console.log("Mover de "+mover[i][1]+" para "+linha_final)
       array_move(os_cilindros,mover[i][1],linha_final)
             
             
        }
       }
       
       
       
      // var linha_destino = linha-1
      // if (linha > 0){
      // array_move(os_cilindros,linha,linha_destino)
       
       
       preencheTabelaCilindros()
      // }
      
        }
        
        function move_abaixo(){
             var linha = parseInt(event.srcElement.id)
       console.log(linha)
       var mover = []
       var outras = []
       if (os_cilindros[linha].mesmo_cilindro === false){
       var nome_cor = os_cilindros[linha].cor
       var eh_igual = new RegExp(".*"+nome_cor+".*")
       for (i=linha;i<os_cilindros.length;i++){
           if (eh_igual.test(os_cilindros[i].cor) === true){
               mover.push([os_cilindros[i],i])
           } else {
               outras.push([os_cilindros[i],i])
           }
           
           
       }
       var busca_ultima = outras[0][0].cor
       var eh_proxima = new RegExp(".*"+busca_ultima+".*")
       var proxima_cor = []
       for (i=outras[0][1];i<os_cilindros.length;i++){
           if (eh_proxima.test(os_cilindros[i].cor) === true){
               proxima_cor.push(os_cilindros[i])
           }
       }
       
       
       mover = mover.reverse()
       //console.log(mover)
       console.log("A proxima cor")
       console.log(proxima_cor.length)
      for (i=0;i<mover.length;i++){
       // if (posicao_ultimo < os_cilindros.length-1){
   
            var linha_final = mover[i][1]+proxima_cor.length
            console.log("Mover de "+mover[i][1]+" para "+linha_final)
        array_move(os_cilindros,mover[i][1],linha_final)
             
             
        }
    //   }
      //var linha_destino = linha+1
      // if (linha < os_cilindros.length-1){
      // array_move(os_cilindros,linha,linha_destino)
       
       
       preencheTabelaCilindros()
      // }
       }
      
        }
        
          function duplicar_cilindro(){
           var linha = parseInt(event.srcElement.id)
          console.log(linha)
          var para_duplicar = os_cilindros[linha]
          var outro = os_cilindros[linha]
          var nome_cor = para_duplicar.cor.replace(" 2x","").replace(" 3x","").replace(" 4x","").replace(" 5x","")
          var busca_outras = new RegExp(".*"+nome_cor+".*")
          var existem = 0
          for (i=0;i<os_cilindros.length;i++){
              if (busca_outras.test(os_cilindros[i].cor) === true){
                  existem = existem+1
              }
          }
          var total = existem+1
          var numero = total+"x"
           var info_cilindro = {}
           info_cilindro["cor"] = nome_cor+" "+numero
           info_cilindro["hex"] = para_duplicar.hex
           info_cilindro["angulo"] =para_duplicar.angulo
           info_cilindro["corpo"] =para_duplicar.corpo
           info_cilindro["fotocelula"] =false
            info_cilindro["gravacao"] = para_duplicar.gravacao
             info_cilindro["lineatura"] = para_duplicar.lineatura
              info_cilindro["numero"] = para_duplicar.numero
               info_cilindro["pct_fotocelula"] = 0
               info_cilindro["perimetro"] = para_duplicar.perimetro
               info_cilindro["profundidade"] = para_duplicar.profundidade
               info_cilindro["tarja"] = false
               info_cilindro["tipo"] = para_duplicar.tipo
               info_cilindro["mesmo_cilindro"] = true

         
          
          os_cilindros.splice(linha+1, 0, info_cilindro)
          
          preencheTabelaCilindros()
      }
      
        
        function preencheDadosCilindro(){
           
            var qual_cilindro = document.getElementById("numero").value
           var cilindro_caracteristica =  api.custom_objects.list_with_options("BR-ROTOC_romaneio",["CLIENTE","equal to",document.getElementById("id_cliente").innerText,"and","detalhes_romaneio.NR_CILINDRO","contains",qual_cilindro]).results
            
            document.getElementById("perimetro").value = cilindro_caracteristica[0].PERIMETRO
             document.getElementById("corpo").value = cilindro_caracteristica[0].CORPO
           
            var os_detalhes_romaneio = cilindro_caracteristica[0].detalhes_romaneio
            
            for (i=0;i<os_detalhes_romaneio.length;i++){
                if (os_detalhes_romaneio[i].NR_CILINDRO == qual_cilindro){
                    console.log(os_detalhes_romaneio[i].TPCILINDRO)
                    if (os_detalhes_romaneio[i].TPCILINDRO == "COBRE"){
                        document.getElementById("tipo").value = "CIC"
                    }
                    if (os_detalhes_romaneio[i].TPCILINDRO == "FERRO"){
                        document.getElementById("tipo").value = "CIF"
                    }
                }
            }

        }
        
        
    </script>  
      
  <script>
      
      // verifica se o cliente existe e busca os cilindros desse cliente
      
      function verifica_cliente(){
          
          var options5=''
          document.getElementById('codigos_cilindro').innerHTML = options5
          
          var qual_nome = document.getElementById("busca_cliente").value
          
          var busca_codigo = api.custom_objects.list_with_options("BR-ROTOC_customers",["FANTASIA","equal to",qual_nome],[],["CODIGO"]).results
          
          if (busca_codigo.length > 0){
              
              // verifica se o cliente possui codigo na base
              
              
              if (busca_codigo[0].CODIGO != undefined){
              document.getElementById("id_cliente").innerText = busca_codigo[0].CODIGO
              document.getElementById("error_busca_cliente").innerText = ""
            document.getElementById("imagem_adiciona_cliente").style = "display: none;"
              
              var busca_romaneio = api.custom_objects.list_with_options("BR-ROTOC_romaneio",["CLIENTE","equal to", busca_codigo[0].CODIGO.toString()],[],["PERIMETRO","CORPO","detalhes_romaneio"]).results
            var detalhes_cilindro = []
            for (i=0;i<busca_romaneio.length;i++){
    var os_romaneios = busca_romaneio[i].detalhes_romaneio
    for (j=0;j<os_romaneios.length;j++){
        detalhes_cilindro.push(os_romaneios[j].NR_CILINDRO)
    }
            }
        var unicos_cilindros = detalhes_cilindro.filter(onlyUnique)
        var options5=''; // variable to store the options
        for(var i = 0; i < unicos_cilindros.length; i++){
          if (unicos_cilindros[i] != ""){  
        options5 += '<option value="'+unicos_cilindros[i]+'" />';
          }
        }
          document.getElementById('codigos_cilindro').innerHTML = options5;

        
          }
          }
          else {
            document.getElementById("error_busca_cliente").innerText = "Cliente não encontrado na base de dados!"
            document.getElementById("imagem_adiciona_cliente").style = "display: inline-block;"
          }
         
    }



  </script>
  
  <script>
      function editar_cilindro(){
          
       var linha = event.srcElement.id
       console.log(linha)
       for (i=0;i<os_cilindros.length;i++){
           if (os_cilindros[i].cor == linha){
               var chaves = Object.keys(os_cilindros[i])
               
               for (j=0;j<chaves.length;j++){
                   if (chaves[j] != "hex" || chaves[j] != "fotocelula" || chaves[j] != "pct_fotocelula" ){
                   document.getElementById(chaves[j]).style = "border-color: orange; background-color: floralwhite;"
              document.getElementById(chaves[j]).value = os_cilindros[i][chaves[j]]
                   }
               }
              
              
           }
       }
      }
      
      function apagar_cilindro(){
          if (confirm("Deseja mesmo apagar esse cilindro?") === true){
            var linha = event.srcElement.id
            
          
            
            
            for (i=0;i<os_cilindros.length;i++){
                var numero = i+1
                if (os_cilindros[i].cor == linha){
                    var tira = os_cilindros.splice(i,1)
                    var indice_tira = i
                }
            
                
            }
                    
                    preencheTabelaCilindros()
                }
      }
            
    
  </script>
  <script>
      // funcoes de codigo de barras
      if (os_codigos_barra === undefined){
      var os_codigos_barra = []
      }
      
      function adiciona_codigo_barras(){
          var tipo_de_codigo = document.getElementById("tipo_codigo").value
          var o_codigo = document.getElementById("valor_codigo").value
          var existe = false
          
          if (tipo_de_codigo == "undefined"){
              document.getElementById("error_tipo_codigo_barra").innerText = "Selecione o tipo de código"
          } else {
             document.getElementById("error_tipo_codigo_barra").innerText = "" 
          }
          if (o_codigo == ""){
              document.getElementById("error_numero_codigo_barra").innerText = "Não é possível incluir um código em branco"
          } else {
              document.getElementById("error_numero_codigo_barra").innerText = ""
          }
          
          if (tipo_de_codigo != "undefined" && o_codigo != ""){
              var existe = false
              for (i=0;i<os_codigos_barra.length;i++){
                  if (os_codigos_barra[i].tipo == tipo_de_codigo && os_codigos_barra[i].valor == o_codigo){
                      existe = true
                      var indice = i
                  }
              }
              
              console.log
              if (existe === false){
                  var info_codigo = {}
                  info_codigo["tipo"] = tipo_de_codigo
                  info_codigo["valor"] = o_codigo
                  os_codigos_barra.push(info_codigo)
              } 
              
          }
         preencheCodigosBarra() 
      }
      
     function preencheCodigosBarra(){
          var table = document.getElementById("tabelaCodigosBarra")
        clearTable(table)
        var qtasrow = table.rows.length
      
       
        
            
        for (i=0;i<os_codigos_barra.length;i++){
           
            // preenche as cores da fotocelula
            
          
            
            
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            
          
            
            cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"> '+os_codigos_barra[i].tipo+'</div>'
            cell2.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+os_codigos_barra[i].valor+'</div>'
            cell3.innerHTML = '<div style="font-size: 1em; display: inline-block; cursor: pointer;" ><img id="'+os_codigos_barra[i].tipo+'_'+os_codigos_barra[i].valor+'" src="./Icons/delete.png" width="50px" onclick="apagar_codigoBarra()"></div>'
         
            qtasrow = qtasrow +1
         
        }    
         
         preencheTabelaCilindros()
      }
      
      function apagar_codigoBarra(){
           var linha = event.srcElement.id
           var linha_array = linha.split("_")
           console.log(linha_array[0])
           console.log(linha_array[1])
           for (i=0;i<os_codigos_barra.length;i++){
               if (os_codigos_barra[i].tipo == linha_array[0] && os_codigos_barra[i].valor == linha_array[1]){
                   var tira = os_codigos_barra.splice(i,1)
               }
           }
           preencheCodigosBarra()
      }
      
  </script>
  
  <script>
      // funçnoes de fluxo de aprovação
      
      function criar_novo_fluxo(){
          
          if (document.getElementById("salvar_fluxo").checked === true){
              document.getElementById("mostra_nome_fluxo").style = "display: inline-block"
          } else {
              document.getElementById("mostra_nome_fluxo").style = "display: none" 
               document.getElementById("nome_novo_fluxo").value = ""
          }
          
      }
      
      var os_fluxos_aprovacao = {}
      
      function que_envia_aprovacao(){
           var linha = event.srcElement.id
          if (os_fluxos_aprovacao.que_enviar === undefined){
              var envia = []
              envia.push(linha)
              os_fluxos_aprovacao["que_enviar"] = envia
          } else {
              var envia_existentes = os_fluxos_aprovacao.que_enviar
              envia_existentes.push(linha)
              os_fluxos_aprovacao["que_enviar"] = envia_existentes
          }
      
          
          
      }
      
      
      var os_aprovadores = []
      
      function adiciona_aprovadores(){
          var nome = document.getElementById("nome_aprovador").value
          var email = document.getElementById("email_aprovador").value
          
          var valid_nome = false
          var valid_email = false
          
          if (nome == ""){
            document.getElementById("error_nome_aprovador").innerText = "O nome não pode estar em branco."  
          } else {
             var test_nome = new RegExp("^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z]*)*$")
             if (test_nome.test(nome) === true){
            document.getElementById("error_nome_aprovador").innerText = ""   
            valid_nome = true
             } else {
               document.getElementById("error_nome_aprovador").innerText = "Há números ou caracteres especiais no nome do aprovador."    
             }
          }
          if (email == ""){
            document.getElementById("error_email_aprovador").innerText = "O email não pode estar em branco."  
          } else {
           var test_email = new RegExp("[a-z0-9]+@[a-z]+\.[a-z]{2,3}")
           if (test_email.test(email) === false){
              document.getElementById("error_email_aprovador").innerText = "Entre com um email valido"  
           } else {
            document.getElementById("error_email_aprovador").innerText = "" 
            valid_email = true
          }
          }
          
         if (valid_nome === true && valid_email === true){
             if (document.getElementInfo("info_aprovador").innerText == ""){
             info_aprova = {}
             info_aprova["nome"] = nome
             info_aprova["email"] = email
             os_aprovadores.push(info_aprova)
             os_fluxos_aprovacao["aprovadores"] = os_aprovadores
             } else {
                 var aprova = document.getElementInfo("info_aprovador").innerText
                 var aprova_array = aprova.split("_")
             }
            
         }
         
          
          preencheTabelaAprovadores()
      }
      
      
      
      function salva_teste(){
         var linha = event.srcElement.id
         console.log(linha)
         var cliente = document.getElementById("id_cliente").innerText
         var busca_cliente = api.custom_objects.list_with_options("BR-ROTOC_customers",["CODIGO","equal to",parseInt(cliente)]).results
         
         if (busca_cliente.length == 0){
             alert("Para enviar uma aprovação é necessário selecionar o cliente!")
         } else {
             var fluxos = busca_cliente[0].fluxos
             
             if (fluxos == undefined){
                 
             }
         }
         
         
          
      }
      
  </script>
  <script>
  var as_tarefas = busca_ID.tarefas
 
 
       function preencheTabelaTarefas(){
         console.log(as_tarefas)
          var table = document.getElementById("tabelaTarefas")
        clearTable(table)
        var qtasrow = table.rows.length
      
        for (i=0;i<as_tarefas.length;i++){
           
            // preenche as cores da fotocelula
            
          
            
            
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
             var cell4 = row.insertCell(3);
              var cell5 = row.insertCell(4);
            
          var data_de_criacao = new Date(as_tarefas[i].criacao)
          var data_criacao_ok = dateFormat(data_de_criacao,"dd/mm/yyyy - hh:mm tt")
            
            cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"> '+data_criacao_ok+'</div>'
            cell2.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+as_tarefas[i].de_quem.fullname+'</div>'
            cell3.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+as_tarefas[i].para_quem+'</div>'
            cell4.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+as_tarefas[i].o_que+'</div>'
            cell5.innerHTML = '<div style="font-size: 1em; display: inline-block; cursor: pointer;" ><img id="'+as_tarefas[i].id+'" src="./Icons/delete.png" width="50px" onclick="apagar_tarefa()"></div>'
         
            qtasrow = qtasrow +1
         
        }    
    

         
        preencheCodigosBarra()
         
     }
  </script>
  
  
  
  <script>
       function preencheTabelaAnexos(){
        
            
        
          var table = document.getElementById("tabelaDocumentos")
        clearTable(table)
        var qtasrow = table.rows.length
      
       
            
        for (i=0;i<busca_ID.anexos_tecnicos.length;i++){
           
            // preenche as cores da fotocelula
            
          
            
            
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
             var cell4 = row.insertCell(3);
              var cell5 = row.insertCell(4);
              
              var data_envio = new Date(busca_ID.anexos_tecnicos[i].data_upload)
              
              var data_envio_ok = dateFormat(data_envio,"dd/mm/yyyy - hh:mm tt")
            if (busca_ID.anexos_tecnicos[i].tipo_arquivo == "arte"){
               var tipo_de_anexo = "Arquivos Arte" 
            } else {
               var tipo_de_anexo = "N/A" 
            }
          
            
            cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"> '+data_envio_ok+'</div>'
            cell2.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+busca_ID.anexos_tecnicos[i].usuario.fullname+'</div>'
            cell3.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+busca_ID.anexos_tecnicos[i].arquivo+'</div>'
            cell4.innerHTML = '<div style="font-size: 1em; display: inline-block;" >'+tipo_de_anexo+'</div>'
            cell5.innerHTML = '<div style="font-size: 1em; display: inline-block;" ><a href="http://187.62.215.93:9090/'+busca_ID.anexos_tecnicos[i].download_link+'">Baixar Arquivo</a></div>'
           
            qtasrow = qtasrow +1
         
        }
        preencheTabelaTarefas()
        }
        
         
       preencheTabelaAnexos() 
       
    
  </script>
  
  <script>
      function seleciona_servico(){
          
         var qual_servico = document.getElementById("especifica_servico").value
         
         if (qual_servico == "NOVO"){
             document.getElementById("mostra_referencias").style = "display: none"
         } else {
            document.getElementById("mostra_referencias").style = "display: inline-block" 
         }
          
      }
  </script>
  <script>
                 function busca_referencia(){
          var OP = document.getElementById("numero_OP").value
        console.log("nuemreo da OP")
        console.log(OP == "")
        console.log(OP == undefined)
          
          if (OP != ""){
              document.getElementById("codigo_fotografia").value = "Buscando..."
              document.getElementById("codigo_fotografia").readOnly = true
               document.getElementById("servico").value = "Buscando..."
              document.getElementById("servico").readOnly = true
              var busca_OP_anterior = api.custom_objects.list_with_options("OrdemProducao",["OP","equal to",parseInt(OP)],[],["OP_Antiga","cliente","info_produto"]).results
              console.log("achei a OP anterior")
              console.log(busca_OP_anterior)
              if (busca_OP_anterior.length === 0){
                  document.getElementById("error_busca_OP").innerText = "Não foi possível encontrar essa OP"
                  document.getElementById("codigo_fotografia").value = ""
              document.getElementById("codigo_fotografia").readOnly = false
              document.getElementById("codigo_fotografia").style = "background-color: white"
               document.getElementById("servico").value = ""
              document.getElementById("servico").readOnly = false
              document.getElementById("servico").style = "background-color: white"
              } else {
                 document.getElementById("codigo_fotografia").value = busca_OP_anterior[0].OP_Antiga.COD_FOTO
                 document.getElementById("codigo_fotografia").readOnly = true
                 document.getElementById("codigo_fotografia").style = "background-color: lightgreen"
                  document.getElementById("servico").value = busca_OP_anterior[0].OP_Antiga.SERVICO
                 document.getElementById("servico").readOnly = true
                 document.getElementById("servico").style = "background-color: lightgreen"
                  
              }
          } else {
               document.getElementById("codigo_fotografia").value = ""
             document.getElementById("error_busca_OP").innerText = ""
             document.getElementById("codigo_fotografia").readOnly = false
                 document.getElementById("codigo_fotografia").style = "background-color: white"
                 document.getElementById("servico").value = ""
                  document.getElementById("servico").readOnly = false
                 document.getElementById("servico").style = "background-color: white"
          }
          if (busca_OP_anterior != undefined){
           if (busca_OP_anterior.length > 0){
              preencheCampos(busca_OP_anterior[0])
          }
          }
      }
          
           function busca_referencia2(){
            var fotografia = document.getElementById("codigo_fotografia").value
         
           if (fotografia != ""){
              document.getElementById("numero_OP").value = "Buscando..."
              document.getElementById("numero_OP").readOnly = true
               document.getElementById("servico").value = "Buscando..."
              document.getElementById("servico").readOnly = true
              var busca_OP_anterior = api.custom_objects.list_with_options("OrdemProducao",["OP_Antiga.COD_FOTO","equal to",fotografia],[],["OP_Antiga","cliente","info_produto"]).results
              if (busca_OP_anterior.length === 0){
                  document.getElementById("error_busca_fotografia").innerText = "Não foi possível encontrar esse Código"
                  document.getElementById("numero_OP").value = ""
              document.getElementById("numero_OP").readOnly = false
              document.getElementById("numero_OP").style = "background-color: white"
               document.getElementById("servico").value = ""
              document.getElementById("servico").readOnly = false
              document.getElementById("servico").style = "background-color: white"
              } else {
                 document.getElementById("numero_OP").value = busca_OP_anterior[0].OP_Antiga.NR_OP
                 document.getElementById("numero_OP").readOnly = true
                 document.getElementById("numero_OP").style = "background-color: lightgreen"
                  document.getElementById("servico").value = busca_OP_anterior[0].OP_Antiga.SERVICO
                 document.getElementById("servico").readOnly = true
                 document.getElementById("servico").style = "background-color: lightgreen"
                  
              }
          } else {
               document.getElementById("numero_OP").value = ""
             document.getElementById("error_busca_OP").innerText = ""
             document.getElementById("numero_OP").readOnly = false
                 document.getElementById("codigo_fotografia").style = "background-color: white"
                 document.getElementById("servico").value = ""
                  document.getElementById("servico").readOnly = false
                 document.getElementById("servico").style = "background-color: white"
          }
          if (busca_OP_anterior.length > 0){
              preencheCampos(busca_OP_anterior[0])
          }
           }
          function busca_referencia3(){
           var servico = document.getElementById("servico").value
           if (servico != ""){
              document.getElementById("codigo_fotografia").value = "Buscando..."
              document.getElementById("codigo_fotografia").readOnly = true
               document.getElementById("numero_OP").value = "Buscando..."
              document.getElementById("numero_OP").readOnly = true
              var busca_OP_anterior = api.custom_objects.list_with_options("OrdemProducao",["OP_Antiga.SERVICO","contains text like",servico],[],["OP_Antiga","cliente","info_produto"]).results
              if (busca_OP_anterior.length === 0){
                  document.getElementById("error_busca_servico").innerText = "Não foi possível encontrar esse Serviço"
                  document.getElementById("codigo_fotografia").value = ""
              document.getElementById("codigo_fotografia").readOnly = false
              document.getElementById("codigo_fotografia").style = "background-color: white"
               document.getElementById("numero_OP").value = ""
              document.getElementById("numero_OP").readOnly = false
              document.getElementById("numero_OP").style = "background-color: white"
              } else {
                 document.getElementById("codigo_fotografia").value = busca_OP_anterior[busca_OP_anterior.length-1].OP_Antiga.COD_FOTO
                 document.getElementById("codigo_fotografia").readOnly = true
                 document.getElementById("codigo_fotografia").style = "background-color: lightgreen"
                  document.getElementById("numero_OP").value = busca_OP_anterior[busca_OP_anterior.length-1].OP_Antiga.NR_OP
                 document.getElementById("numero_OP").readOnly = true
                 document.getElementById("numero_OP").style = "background-color: lightgreen"
                 document.getElementById("servico").value = busca_OP_anterior[busca_OP_anterior.length-1].OP_Antiga.SERVICO
                  
              }
          } else {
               document.getElementById("codigo_fotografia").value = ""
             document.getElementById("error_busca_OP").innerText = ""
             document.getElementById("codigo_fotografia").readOnly = false
                 document.getElementById("codigo_fotografia").style = "background-color: white"
                 document.getElementById("numero_OP").value = ""
                  document.getElementById("numero_OP").readOnly = false
                 document.getElementById("numero_OP").style = "background-color: white"
          }
           if (busca_OP_anterior.length > 0){
              preencheCampos(busca_OP_anterior[busca_OP_anterior.length-1])
          }
          }
          
          function abrecampos(){
               
             document.getElementById("error_busca_OP").innerText = ""
              document.getElementById("error_busca_fotografia").innerText = ""
               document.getElementById("error_busca_servico").innerText = ""
               document.getElementById("numero_OP").readOnly = false
                document.getElementById("numero_OP").value = ""
                 document.getElementById("numero_OP").style = "background-color: white"
                document.getElementById("codigo_fotografia").readOnly = false
                document.getElementById("codigo_fotografia").value = ""
                 document.getElementById("codigo_fotografia").style = "background-color: white"
                 document.getElementById("servico").value = ""
                  document.getElementById("servico").readOnly = false
                 document.getElementById("servico").style = "background-color: white"
                 document.getElementById("busca_cliente").value = ""
              document.getElementById("busca_cliente").value = ""
              document.getElementById("o_servico").value = ""
              document.getElementById("especifica_produto").value = ""
              document.getElementById("especifica_material").value = ""
              document.getElementById("o_servico").style = "background-color: white; border-color: #ced4da"
              document.getElementById("especifica_produto").style = "background-color: white; border-color: #ced4da"
              document.getElementById("especifica_material").style = "background-color: white; border-color: #ced4da"
              document.getElementById("busca_cliente").style = "background-color: white; border-color: #ced4da"
                 
          }
          
          
             function preencheCampos(referencia){
              console.log(referencia)
              console.log(referencia.OP_Antiga.SERVICO)
              document.getElementById("busca_cliente").value = referencia.cliente.FANTASIA
              document.getElementById("o_servico").value = referencia.OP_Antiga.SERVICO
              document.getElementById("especifica_produto").value = referencia.info_produto.produto.DESCRICAO
              document.getElementById("especifica_material").value = referencia.info_produto.material.DESCRICAO
               document.getElementById("busca_cliente").style = "background-color: #FEF1E6; border-color: orange;"
               document.getElementById("o_servico").style = "background-color: #FEF1E6; border-color: orange;"
               document.getElementById("especifica_produto").style = "background-color: #FEF1E6; border-color: orange;"
               document.getElementById("especifica_material").style = "background-color: #FEF1E6; border-color: orange;"
          }
         
  </script>
  <script>
      function grava_pedido(){
          
         if (busca_ID.info_geral.data_alteracao === undefined){
         var data_alteracao = []
         data_alteracao.push(new Date())
          busca_ID.info_geral["data_alteracao"] = data_alteracao
      } else {
          var data_existente = busca_ID.info_geral.data_alteracao
          data_existente.push(new Date)
          busca_ID.info_geral["data_alteracao"] = data_existente
      }
      var theSolicita = new Date(document.getElementById("data-solicita").value)
      busca_ID.info_geral["data_solicitacao"] = theSolicita
      busca_ID.info_geral["tipo_servico"] = document.getElementById("especifica_servico").value
       busca_ID.info_geral["op_anterior"] = document.getElementById("numero_OP").value
        busca_ID.info_geral["codigo_fotografia"] = document.getElementById("codigo_fotografia").value
         busca_ID.info_geral["servico"] = document.getElementById("o_servico").value
      
      var busca_cliente = api.custom_objects.list_with_options("BR-ROTOC_customers",["FANTASIA","equal to",document.getElementById("busca_cliente").value]).results
      
      // busca o cliente e não grava o pedido de clientes não cadastrados
      
      if (busca_cliente.length == 0){
          document.getElementById("error_busca_cliente").innerText = "Cliente não cadastrado."
      } else {
          document.getElementById("error_busca_cliente").innerText = ""
         busca_ID.info_geral["nome_cliente"] = busca_cliente[0]
         
         busca_ID.info_geral["sub_cliente"] = document.getElementById("sub_cliente").value
         busca_ID.info_geral["produto"] = document.getElementById("especifica_produto").value
         busca_ID.info_geral["material"] = document.getElementById("especifica_material").value
         busca_ID.info_embalagem["largura_material"] = document.getElementById("largura").value
         busca_ID.info_embalagem["especifica_ladoImpressao"] = document.getElementById("especifica_ladoImpressao").value
         busca_ID.info_embalagem["faixas"] = document.getElementById("faixas").value
         busca_ID.info_embalagem["medida_faixa"] = document.getElementById("medida_faixa").value
         busca_ID.info_embalagem["entre_faixa"] = document.getElementById("entre_faixa").value
         busca_ID.info_embalagem["largura_total"] = document.getElementById("largura_total").value
         busca_ID.separacoes = os_cilindros
         busca_ID.fotoc_tarja["largura_fotocelula"] = document.getElementById("largura_fotocelula").value
         busca_ID.fotoc_tarja["altura_fotocelula"] = document.getElementById("altura_fotocelula").value
         busca_ID.fotoc_tarja["passo_fotocelula"] = document.getElementById("passo_fotocelula").value
         busca_ID.fotoc_tarja["qtde_fotocelula"] = document.getElementById("qtde_fotocelula").value
         busca_ID.fotoc_tarja["posicao_fotocelula"] = fotocelulas
         busca_ID.fotoc_tarja["local_tarja"] = document.getElementById("local_tarja").value
         busca_ID.fotoc_tarja["medida_tarja"] = document.getElementById("medida_tarja").value
         busca_ID.fotoc_tarja["tipo_registro"] = document.getElementById("tipo_registro").value
         busca_ID.fotoc_tarja["largura_fotocelula"] = document.getElementById("largura_fotocelula").value
         busca_ID.puxada["valor"] = document.getElementById("valor_puxada").value
         busca_ID.puxada["qual_cilindro"] = document.getElementById("qual_cilindro").value
         busca_ID["codigos_barra"] = os_codigos_barra
         
         
         
         
         
      
       
         
          
              
     api.custom_objects.update("BR-ROTOC_pedidos",busca_ID)
     
     
        location.reload()
        
         // console.log(data_pedido)
          
      } 
          
          
      }
      
      
      
  </script>
<script>
  
      function calcula_largura(){
          
          
          var num_faixas = parseInt(document.getElementById("faixas").value)
          var larg_faixa = parseFloat(document.getElementById("medida_faixa").value)
          var entre_faixa = parseFloat(document.getElementById("entre_faixa").value)
         document.getElementById("largura_total").value = ((num_faixas*(larg_faixa+entre_faixa))-entre_faixa).toFixed(3)
          
      }
</script>
<script>
     function adiciona_tarefa(){
          var tarefa = {}
          tarefa["para_quem"] = document.getElementById("tarefa_departamento").value
          tarefa["de_quem"] = usuario
          tarefa["o_que"] = document.getElementById("tarefa_descricao").value.trim()
         
         var data_pagina = {}
       
         var the_tasks = {}
         the_tasks["tarefas"] = busca_ID.tarefas
         data_pagina["info_step4"] = the_tasks
                
          
          
          var cria_ID = api.hub.start_from_whitepaper_with_files_and_variables("CADOP_v2","tarefa_ID",[] , {"data_pagina":data_pagina,"usuario":usuario,"tarefa":tarefa});
          var workable_cri = cria_ID.workable_id
          console.log(workable_cri)
      
      
       var workableConsoleLog = function ()  {
             console.log("Estou executando!")
         var o_estado = api.workable.get_merged_variables(workable_cri)
         console.log(o_estado)
        if (o_estado.variables.id_tarefa != undefined){
          console.log("encontrei!")
    //        a_tarefa = o_estado.variables.tarefa
  	   as_tarefas = o_estado.variables.info_step4.value.tarefas
  	   busca_ID.tarefas = o_estado.variables.info_step4.value.tarefas
  	   //         console.log(as_tarefas)
  	 //           data_pagina.info_step4.tarefas = as_tarefas
             myStopFunction();
          }
    
        else {
        console.log("esperando")
            }
        }
         
    
     var workflowTimeout = setInterval(workableConsoleLog, 1000);
		function myStopFunction() {
	document.getElementById("tarefa_descricao").value = ""	    
     clearInterval(workflowTimeout);
     preencheTabelaTarefas()
    }
     }
     
      function muda_gravacao(){
          if (document.getElementById("gravacao").value != "undefined"){
              if (document.getElementById("gravacao").value == "ELETROMECÂNICA"){
                  document.getElementById("mostra_profundidade").style = "display: none;"
              } else {
                 document.getElementById("mostra_profundidade").style = "display: inline-block;" 
              }
          } else {
             document.getElementById("mostra_profundidade").style = "display: none;" 
          }
          
      }
</script>







    </body>

</html>