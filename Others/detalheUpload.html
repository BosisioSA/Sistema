<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Detalhes Upload - Finepack</title>
        <meta name="description" content="Versioning">
        <meta name="viewport" content="width=944">
        <meta name="robots" content="noindex, follow">
	<link rel="Shortcut icon" href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/favicon.ico" type="image/x-icon">
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon.png" rel="apple-touch-icon" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144" />
        <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/table.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/popper.js"></script>
        <script src="js/main.js"></script>

        <script src="/portal.cgi/PP_FILE_STORE/Sistema/assets/js/vendor/modernizr-2.6.2.min.js"></script>
      	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-1.8.3.min.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-ui-1.9.2.custom.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.cookie.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.appear-1.1.1.min.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-linedtextarea.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/codemirror.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/javascript.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.tmpl.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-regex.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/sitemapstyler.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/date.format.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.iframe-transport.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.notify.min.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.event.drag-2.2.js'></script>
    
        <script type='text/javascript' src='/portal.cgi?api=js'></script>
    	<!--<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/portal/js/nixps-portal-api.js'></script>-->
         <script>
          function logout() {
               $.cookie('user_id', '', { expires: -1, path: '/' });
               $.cookie('user_hash', '', { expires: -1, path: '/' });
               $.cookie('expiration_date', '', { expires: -1, path: '/' });
               $.cookie('customer_id', '', { expires: -1, path: '/' });
               $.cookie('customer_name', '', { expires: -1, path: '/' });
               $.cookie('username', '', { expires: -1, path: '/' });
               $.cookie('scope', '', { expires: -1, path: '/' });
               var lSession = api_sync.auth.create_session('', ''); // fecha sessao do CloudFlow
               var l_url = '/portal.cgi/PP_FILE_STORE/Public/Login/login.html'
               window.location.href = l_url;
               //window.location.href = '?upload=done';
          }
             
           
       </script>
        <script>
            var queryString = window.location.search;
            //console.log(queryString);
            //var ordem2 = queryString.substring(7)
            var ordem = decodeURI(queryString.substring(7,queryString.length))
            console.log(ordem)
        </script>

    </head>


    <body>


      <div class="wrapper d-flex align-items-stretch">
  			<nav id="sidebar">
  				<div class="p-4 pt-5">
            <img>
  		  	<img src="./logo/finepack.png" style="width: 70%; margin-bottom: 50px;">
  	        
  	        <div style="width: 100%"><a id="link_proofscope" href="#" target="_blank"><img id="preview" width="100%"></a></div>

  	        <div class="footer">
  	        	<p style="font-size: 6pt; margin-top:380px">Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0.
  						  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
  						  Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
  	        </div>

  	      </div>
      	</nav>

          <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">

              <button type="button" id="sidebarCollapse" class="btn btn-primary">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
              </button>
              <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars"></i>
              </button>
               <div class="col-md-5" id="bemvindo"></div>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav ml-auto">
                  <li class="nav-item">
                      <a class="nav-link" onclick="logout()">Logout</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        <div class="col-md-7" style="display: inline-block;">  
        <h2>Informações do Upload</h2>
        </div>
        <form id="formularioOS">
          <section class="form-group col-md-7" style="float: left;"></section>
          
          <div class="form-group col-md-4" style="display:inline-block; padding-right: 8px;">
            <label for="dataUpload">Data Upload</label>
            <input type="text" class="form-control" id="dataUpload" name="dataUpload" readonly>
          </div>
          <!--<div class="form-group col-md-2" style="display:inline-block;">
            <label for="sku">SKU</label>
            <input type="text" class="form-control" id="sku" name="sku">
          </div>-->
          <div class="form-group col-md-11" style="display:inline-block;">
            <label for="descricao">Descricao</label>
            <input type="text" class="form-control" id="descricao" name="descricao">
          </div>
          <div class="form-group col-md-2" style="display:inline-block;">
            <label for="codigoCliente">Codigo Cliente</label>
            <input type="text" class="form-control" id="codigoCliente" name="codigoCliente" readonly>
          </div>
          <div class="form-group col-md-5" style="display:inline-block;">
            <label for="nomeCliente">Nome Cliente</label>
            <input type="text" class="form-control" id="nomeCliente" name="nomeoCliente" readonly>
          </div>
          <div class="form-group col-md-4" style="display:inline-block;">
            <label for="codBarras">Codigo Barras</label>
            <input type="text" class="form-control" id="codBarras" name="codBarras">
          </div>
          
          <div class="form-group col-md-2" style="display:inline-block;">
            <label for="passo">Passo</label>
            <input type="number" class="form-control" id="passo" name="passo">
          </div>
          
          <div class="form-group col-md-2" style="display:inline-block;">
            <label for="largura">Largura</label>
            <input type="number" class="form-control" id="largura" name="largura">
          </div>
          <div class="form-group col-md-3" style="display:inline-block;">
            <label for="responsavel">Responsavel</label>
            <input type="text" class="form-control" id="responsavel" name="responsavel" readonly>
          </div>
          <!--<div class="form-group col-md-1" style="display:inline-block;">
            <a  id="openfolder" href="#" target="_blank"><img src="./assets/img/openFolder.png"  height="40px"></a>
          </div>-->
          <hr>
          <div class="form-group col-md-11">
          <div class="form-group" style="display:inline-block;width: 40%">
          <h4>Cores do arquivo</h4>
          <div class="form-group" style="vertical-align: top; display:inline-block;width: 32%">
          <table id="tabelaCores1">
                <tr>
                <td class="form-group" style="width: 5%"></td>
                <td class="form-group" style="width:40%;"></td>
                </tr>
          </table>
    </div>
    <div class="form-group" style="vertical-align: top; display:inline-block;width: 32%">
      <table id="tabelaCores2">
            <tr>
            <td class="form-group" style="width: 5%"></td>
            <td class="form-group" style="width:40%;"></td>
            </tr>
      </table>
</div>
<div class="form-group" style="vertical-align: top; display:inline-block;width: 32%">
  <table id="tabelaCores3">
        <tr>
        <td class="form-group" style="width: 5%"></td>
        <td class="form-group" style="width:40%;"></td>
        </tr>
  </table>
</div>
    </div>
    <div class="form-group" style="display:inline-block;width: 50%">
      <h4>Resultado Preflight</h4>
      <div class="form-group" style="vertical-align: top; display:inline-block;width: 100%">
      <table id="tabelaPreflight">
            <tr>
            <td class="form-group" style="width:15%">Tipo</td>
            <td class="form-group" style="width:65%;">Descricao</td>
            </tr>
      </table>
</div>
</div>


  
    </div>
                    </form>
                   
                    <section class="form-group col-md-4" style="display:inline-block;"></section>
                    <div style="display: inline-block;"class="form-group col-md-4">
                      <button class="btn-primary" id='iniciaAcao' onclick="salvaMudanca()" style="display: inline-block;">Salvar Alteracoes</button><div id="statusAcao" class="col-md-5" style="display:inline-block;"></div>
                      </div>
                    
                </div>
                </div>


        <div></div>


    <script>
    //Preenche os dados da Ordem
    var infoOS = api.custom_objects.list("Finepack_DummyUpload",["_id","equal to",ordem],[]).results[0];
    
    $("#preview").attr("src","http://189.112.135.139:9090"+infoOS.preview);
    $("#link_proofscope").attr("href",infoOS.proofscope);
    document.getElementById("dataUpload").value = infoOS.data_upload
    document.getElementById("descricao").value = infoOS.Produto
    document.getElementById("codigoCliente").value = infoOS.Codigo_Cliente
    document.getElementById("nomeCliente").value = infoOS.Cliente
    if (infoOS.dimensoes_embalagem != undefined){
    document.getElementById("passo").value = infoOS.dimensoes_embalagem.passo
    document.getElementById("largura").value = infoOS.dimensoes_embalagem.largura
    }
    if (infoOS.codigos_barra.length > 0){
    document.getElementById("codBarras").value = infoOS.codigos_barra[0].codigo
    }
    document.getElementById("responsavel").value = infoOS.responsavel
    
      
var cores = infoOS.Cores_Arquivo
if (cores.length < 6){ 
for(i=0;i<cores.length;i++){
        var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
        var table = document.getElementById("tabelaCores1");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';
        }
        } else {
          if (cores.length < 13){
            var metade = (parseInt(cores.length/2))+1
            console.log(metade)
            for (i=0;i<metade;i++){
              var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
        var table = document.getElementById("tabelaCores1");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';
            }
            for (i=metade;i<cores.length;i++){
              var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
              var table = document.getElementById("tabelaCores2");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';

            }

            }
            if (cores.length > 12){
            var terco = (parseInt(cores.length/3))
            //console.log(metade)
            for (i=0;i<terco;i++){
          var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
        var table = document.getElementById("tabelaCores1");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';
            }
            for (i=terco;i<(terco*2)+1;i++){
              var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
              var table = document.getElementById("tabelaCores2");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';

            }
            for (i=terco*2+1;i<cores.length;i++){
              var nomeCor = cores[i].nome
        var rgbCor = cores[i].rgb
        var rgb_split = rgbCor.split(",")
        var cor_R = parseInt(rgb_split[0])
        var cor_G = parseInt(rgb_split[1])
        var cor_B = parseInt(rgb_split[2])
        var stringRGB = "rgb("+cor_R+","+cor_G+","+cor_B+")"
   
              var table = document.getElementById("tabelaCores3");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+stringRGB+';border-radius:50%;display:inline-block"></span>';
  cell2.innerHTML = '<span style="width: 40%;">'+nomeCor+'</span>';

            }
                    
          
        }
        }

        var preflight = infoOS.Preflight_Info.errors

        for (i=0;i<preflight.length;i++){
          var tipo_erro = preflight[i].severity
          var nome_erro = preflight[i].type
          var qtde = preflight[i].locations.length
          var icone = "./Icons/preflight_info.png"
          if (tipo_erro == "warning"){
            icone = "./Icons/preflight_warning.png"
          }
          if (tipo_erro == "error"){
            icone = "./Icons/preflight_erro.png"
          }
          var informacao = ""
          if (nome_erro == "Detected Barcodes"){
            informacao = "Barcodes Reconhecidos "+preflight[i].locations[0].text
          }
          if (nome_erro == "Redundant clips"){
            informacao = "Clips(masks) redundantes removidos "+preflight[i].locations.length
          }
          if (nome_erro == "Text Objects"){
            informacao = "Texto(s) convertidos em curva "+preflight[i].locations.length
          }
          if (nome_erro == "Low resolution images"){
            informacao = "Existe(m) "+preflight[i].locations.length+" imagem(ns) em baixa resolução"
          }
          if (nome_erro ==  "Mixed Paint Barcodes"){
            informacao = "Existe(m) códigos de barra em mais de uma tinta"
          }
          if (nome_erro == "Pattern Paints"){
            informacao = "Existe(m) "+preflight[i].locations.length+" Objetos com preenchimento em Pattern"
          }
          if (nome_erro == "Unused Separations"){
            informacao = "Foi removido "+preflight[i].locations.length+" separações não usadas"
          }
          if (nome_erro == "Missing Image Files"){
            informacao = "Existe(m) "+preflight[i].locations.length+" imagens faltando link"
          }
          if (nome_erro == "White Text in Overprint"){
            informacao = "Existe(m) "+preflight[i].locations.length+" objeto(s) em Branco Overprint"
          }
          

        var table = document.getElementById("tabelaPreflight");
        var qtasrow = table.rows.length
        var row =  table.insertRow(qtasrow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        
        
  cell1.innerHTML = '<div style="vertical-align: middle;"><img src="'+icone+'" width="20px"></div>';
  cell2.innerHTML = '<span style="width: 70%;">'+informacao+'</span>';

        }

</script>
<script>
  function mostraUpload(){
 var existeUpload = $('#novo_upload:checked').length

 if (existeUpload == 1){
   document.getElementById("uploadNovo").style = "display: inline-block;"
 } else {
  document.getElementById("uploadNovo").style = "display:none;"
 }

  }
</script>
<script>
  function salvaMudanca(){
    var descri_nova =  document.getElementById("descricao").value
    var cod_novo = document.getElementById("codBarras").value
    var passo = document.getElementById("passo").value
    var largura = document.getElementById("largura").value
    var codigo_antigo = {}
    codigo_antigo["codigo"] = cod_novo
    codigo_antigo["tipo"] = "EAN 13"
    var dimensoes = {}
    dimensoes["passo"] = passo
    dimensoes["largura"] = largura
    
   

    api.custom_objects.set_keys("Finepack_DummyUpload",ordem,{"Produto":descri_nova,"codigos_barra":[codigo_antigo],"dimensoes_embalagem":dimensoes})
    window.close();
  }
</script>
<script>
  var usuario = api.auth.get_current_user()
  
</script>
<script>
  $('#descricao').on('keypress', function (event) {
    var regex = new RegExp("^[a-zA-Z0-9 _]+$");
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if (!regex.test(key)) {
       event.preventDefault();
       return false;
    }
});
</script>
    </body>

</html>