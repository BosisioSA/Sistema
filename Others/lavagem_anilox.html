<!doctype html>
<html>
    <head>
      <title>Lavagem Anilox- Valgroup</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      
      <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/table.css">
        <meta name="viewport" content="width=944">
        <meta name="robots" content="noindex, follow">
	<link rel="Shortcut icon" href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/ifucons/favicon.ico" type="image/x-icon">
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon.png" rel="apple-touch-icon" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144" />
        <link rel="stylesheet" href="fonts/fontawesome-all.min.css">
        <link rel="stylesheet" href="fonts/font-awesome.min.css">
        <link rel="stylesheet" href="fonts/fontawesome5-overrides.min.css">
        <script src="js/popper.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
          <script src="js/jscolor.js"></script>
    
        <script src="/portal.cgi/PP_FILE_STORE/Sistema/assets/js/vendor/modernizr-2.6.2.min.js"></script>
      	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-1.8.3.min.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-ui-1.9.2.custom.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.cookie.js'></script>
    	<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js'></script>
    <!-- portal.js -->
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-linedtextarea.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/codemirror.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/javascript.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.tmpl.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-regex.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/sitemapstyler.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/date.format.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.iframe-transport.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.fileupload.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.notify.min.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.event.drag-2.2.js'></script>
        <script type='text/javascript' src='/portal.cgi?api=js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/portal/js/nixps-portal-api.js'></script>
        <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.i18n.js'></script>
       
       
    

    </head>


    <body>

  		<div class="wrapper d-flex align-items-stretch">
  			<nav id="sidebar">
  				<div class="p-4 pt-5">
            <img>
  		  		<img src="./logo/logo_valgroup.png" style="width: 90%; margin-bottom: 50px;">
             <ul class="active components mb-5">
                <li  style="list-style-type: none">
                     <a href="cadastros_anilox.html"><i class="fas fa-cog" style="margin-right: 5px"></i>Novo</a>
                    </li>
                     <li style="list-style-type: none">
                     <a href="lista_anilox.html"><i class="fas fa-list" style="margin-right: 5px"></i>Lista</a>
                    </li>
                    
                    <li  style="list-style-type: none">
                     <a href="alteracao_bcm_anilox.html"><i class="fas fa-wrench" style="margin-right: 5px"></i>Alteração BCM</a>
                    </li>
                    <li class="active" style="list-style-type: none">
                     <a href="lavagem_anilox.html"><i class="fas fa-biohazard" style="margin-right: 5px"></i>Registrar Lavagem</a>
                    </li>
                </ul>
                
                    
       
   
  	        <div class="footer">
  	        	<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0.
  						  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
  						   Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
  	        </div>
  	      </div>
      	</nav>

          <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">

              <button type="button" id="sidebarCollapse" class="btn btn-primary">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
              </button>
              <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars"></i>
              </button>
              <div id="bemvindo" style="margin-left: 20px;"></div>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav ml-auto">
                 <li class="nav-item">
                      <a class="nav-link" href="cadastros_clientes.html">Cadastros</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="solicitacao_desenho.html">Tickets</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="alterar_senha.html" target="_Blank">Alterar Senha</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
          <div>
        <h2 style="display:inline-block;">Registrar Lavagem</h2>
       
        
       
        <br>
        <br>
        
        <div  class="form-group col-md-11" style="display:inline-block;">
        <hr>
       
            <div id="id_anilox" style="display:none"></div>
            <div id="nome_cor" style="display:none"></div>
            
        <h4 id="que_estou_fazendo"></h4>
       
 <h5 id="a_div_entrada"><i id="entradaArrow" class="fas fa-chevron-right" onclick="mostraEntrada()" style="margin-right: 5px; cursor:pointer;"></i>Entrada para Lavagem</h5>
                 <div id="info_entrada" class="form-group" style="display: none">
 
            <div  class="form-group col-md-8" style="display:inline-block;">
                <label for="os_anilox">Selecionar Anilox</label>
                   <select class="form-control" id="os_anilox" onchange="busca_anilox()" name="os_anilox">
                       <option value="undefined">Selecionar...</option>
                    </select>
                    
                 </div>
                 <div  class="form-group col-md-3" style="display:inline-block;">
                <label for="situacao">Situação</label>
                  <input type="text" class="form-control"  id="situacao" name="situacao" readonly>
                 </div>
                 <br>
                  <div  class="form-group col-md-3" style="display:inline-block;">
                <label for="maquina">Máquina</label>
                  <select class="form-control"  id="maquina" onchange="cria_grupo_impressor()" name="maquina">
                      <option value="undefined">Selecionar</option>
                    </select>
                 </div>
                 <div  class="form-group col-md-2" style="display:inline-block;">
                <label for="grupo_impressor">Grupo Impressor</label>
                  <select class="form-control"  id="grupo_impressor" name="grupo_impressor">
                      <option value="undefined">Selecionar</option>
                    </select>
                 </div>
                 <div  class="form-group col-md-3" style="display:inline-block;">
                <label for="cor">Cor</label>
                   <input type="text" class="form-control" onkeyup="this.value=this.value.toUpperCase()" id="cor" name="cor">
                 </div>
                 <!--<div  class="form-group col-md-3" style="display:inline-block;">
                <label for="metragem">Metragem</label>
                   <input type="text" class="form-control"  id="metragem" name="metragem">
                 </div>-->
                 <hr>
                 <h6>Conferência Visual</h6>
                   <div  class="form-group col-md-3" style="display:inline-block;">
                   <input type="checkbox" class="form-group"  id="Batida" name="Batida">
                     <label for="Batida">Batida</label>
                 </div>
                 <!--<div  class="form-group col-md-2" style="display:inline-block;">
                   <input type="checkbox" class="form-group"  id="Batida" name="Batida">
                     <label for="Batida">Batida</label>
                 </div>-->
                 <div  class="form-group col-md-4" style="display:inline-block;">
                   <input type="checkbox" class="form-group"  id="Borda Danificada" name="Borda Danificada">
                     <label for="Borda Danificada">Borda Danificada</label>
                 </div>
                 <div  class="form-group col-md-2" style="display:inline-block;">
                   <input type="checkbox" class="form-group"  id="Risco" name="Risco">
                     <label for="Risco">Risco</label>
                 </div>
                  
                 <div id="div_outros_valor" class="form-group col-md-11" style="display:inline-block;" >
                     <label for="observacoes">Observações</label>
                   <textarea type="text" class="form-control" onkeyup="this.value=this.value.toUpperCase()" id="observacoes" name="observacoes" rows="4">
                      </textarea>
                 </div>
               <br>
               
                  <div id="button_salva" class="form-group col-md-6" style="display:inline-block; vertical-align: bottom;">
                      <div id="msg_salvar_anilox"></div>
                      <button id="save_button" class="btn btn-primary" onclick="salva_lavagem()">Registar Entrada</button>
                      <button class="btn btn-secondary" onclick="cancela_lavagem()">Cancelar</button>
                  </div>
                   </div>
                 <hr>
           <h5 id="a_div_pendentes"><i id="pendentesArrow" class="fas fa-chevron-right" onclick="mostraPendentes()" style="margin-right: 5px; cursor:pointer;"></i>Lavagens Pendentes <span id="qtde_pendente"></span></h5>
                 <div id="info_pendentes" class="form-group" style="display: none">
 
            <br>   
            <table id="tabela_pendencia_lavagens" class="table custom-table" cellspacing="0" width="100%">
          <thead>
            <tr>
             
             <th class="th-sm" style="width:10%; vertical-align: top;">Iniciar Lavagem<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:20%; vertical-align: top;">Data Entrada<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:35%; vertical-align: top;">Anilox<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_anilox" class="form-control" type="text" onkeyup="filtro_anilox()"></span>
              </th>
              <th class="th-sm" style="width:10%; vertical-align: top;">Batida<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:15%; vertical-align: top;">Borda Danificada<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:10%; vertical-align: top;">Risco<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
             
              
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        </div>
        <hr>
        
         <h5 id="a_div_execucao"><i id="execucaoArrow" class="fas fa-chevron-right" onclick="mostraExecucao()" style="margin-right: 5px; cursor:pointer;"></i>Lavagens em Execução <span id="qtde_executando"></span></h5>
                 <div id="info_execucao" class="form-group" style="display: none">
 
        
            <br>   
            <table id="tabela_execucao_lavagens" class="table custom-table" cellspacing="0" width="100%">
          <thead>
            <tr>
             
             <th class="th-sm" style="width:15%; vertical-align: top;">Finalizar Lavagem<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:20%; vertical-align: top;">Iniciada em<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:30%; vertical-align: top;">Anilox<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_anilox" class="form-control" type="text" onkeyup="filtro_anilox()"></span>
              </th>
              <th class="th-sm" style="width:10%; vertical-align: top;">Tipo Lavagem<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              <th class="th-sm" style="width:25%; vertical-align: top;">Responsável<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
                 
                 
       
            
             
            </div>
            
            <!-- terminar mostra locais e começa mostra registro -->
            
          
          
           
                <br>
                  <div id="info_update" style="color: green"></div>
              
            </div>
        
       
  	
  		
  	
  	<script>
  	    // funcoes de apoio
  	    
  	    var usuario = api.auth.get_current_user()
  	    
      function clearTable(table) {
  var rows = table.rows;
  var i = rows.length;
  while (--i) {
    rows[i].parentNode.removeChild(rows[i]);
    // or
    // table.deleteRow(i);
  }
}

function onlyUnique(value, index, self) {
  return self.indexOf(value) === index;
}

function cmyk2rgb(c, m, y, k, normalized){
    c = (c / 100);
    m = (m / 100);
    y = (y / 100);
    k = (k / 100);
    
    c = c * (1 - k) + k;
    m = m * (1 - k) + k;
    y = y * (1 - k) + k;
    
    var r = 1 - c;
    var g = 1 - m;
    var b = 1 - y;
    
    if(!normalized){
        r = Math.round(255 * r);
        g = Math.round(255 * g);
        b = Math.round(255 * b);
    }
    
    return {
        r: r,
        g: g,
        b: b
    }
}

function rgb2cmyk(r, g, b, normalized){
    var c = 1 - (r / 255);
    var m = 1 - (g / 255);
    var y = 1 - (b / 255);
    var k = Math.min(c, Math.min(m, y));
    
    c = (c - k) / (1 - k);
    m = (m - k) / (1 - k);
    y = (y - k) / (1 - k);
    
    if(!normalized){
        c = Math.round(c * 10000) / 100;
        m = Math.round(m * 10000) / 100;
        y = Math.round(y * 10000) / 100;
        k = Math.round(k * 10000) / 100;
    }
    
    c = isNaN(c) ? 0 : c;
    m = isNaN(m) ? 0 : m;
    y = isNaN(y) ? 0 : y;
    k = isNaN(k) ? 0 : k;
    
    return {
        c: c,
        m: m,
        y: y,
        k: k
    }
}


function componentToHex(c) {
  var hex = c.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
  return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
}

// preenche Select

selectTipo = document.getElementById('os_anilox');
    var tiposTipo = api.custom_objects.list_with_options("BR-VALFI_anilox",["processo_lavagem","equal to",false]).results
    for (var i = 0; i<tiposTipo.length; i++){
        var opt = document.createElement('option');
        opt.value = tiposTipo[i]._id;
        opt.innerHTML = tiposTipo[i].numero+" - "+tiposTipo[i].nome;
        selectTipo.appendChild(opt);
    }
    
 var quantas_pendentes = api.custom_objects.count("BR-VALFI_anilox",["processo_lavagem","equal to",true,"and","status_lavagem","equal to","Não Iniciado"]).count
 
 document.getElementById("qtde_pendente").innerText = "("+quantas_pendentes+")"


 var quantas_executando = api.custom_objects.count("BR-VALFI_anilox",["processo_lavagem","equal to",true,"and","status_lavagem","equal to","Iniciado"]).count
 
 document.getElementById("qtde_executando").innerText = "("+quantas_executando+")"


// coloca a data de hoje

var hoje = new Date()
//document.getElementById("data_entrada").value = dateFormat(hoje,"yyyy-mm-dd")


  	</script>
  	
  	<script>
  	    function busca_anilox(){
  	        if (document.getElementById('os_anilox').value != undefined){
  	           $("#maquina").find('option').not(':first').remove();
  	        var busca = api.custom_objects.list_with_options("BR-VALFI_anilox",["_id","equal to",document.getElementById('os_anilox').value]).results[0]
  	        console.log(busca.alteracoes_bcm.length)
  	       /// if (busca.lavagem.length > 0){
  	       // document.getElementById("div_lavagens").style = "display: inline-block;"
  	      //  } else {
  	      //   document.getElementById("div_lavagens").style = "display: none;"
  	       // }
  	        document.getElementById("situacao").value = busca.situacao
  	        selectMaquina = document.getElementById('maquina');
  	        if (busca.maquinas != undefined){
         for (var i = 0; i<busca.maquinas.length; i++){
        var opt = document.createElement('option');
        opt.value = busca.maquinas[i];
        opt.innerHTML = busca.maquinas[i];
        selectMaquina.appendChild(opt);
         }
    }
  	        
  	        
  	      
  	        
  	        
  	    }
  	    }
  	    
  	    var os_tipos_lavagem = api.custom_objects.list("BR-VALFI_lavagemAnilox").results
  	    
  	    function  preenche_lista_pendente_lavagem(){
  	        
  	     clearTable(document.getElementById("tabela_pendencia_lavagens"))
          
          var lavagens = api.custom_objects.list_with_options("BR-VALFI_anilox",["processo_lavagem","equal to",true,"and","status_lavagem","equal to","Não Iniciado"]).results
         var table = document.getElementById("tabela_pendencia_lavagens")
        var qtasrow = table.rows.length
      
            
            for (i=0;i<lavagens.length;i++){
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            
          var ultima_lavagem = lavagens[i].lavagem[lavagens[i].lavagem.length-1]
          console.log(ultima_lavagem)
          
          
          var img_batida = "./Icons/false.png"
          var img_borda = "./Icons/false.png"
          var img_riscos = "./Icons/false.png"
          
          var cor_batida = "red"
          var cor_borda = "red"
          var cor_riscos = "red"
          
          if (ultima_lavagem.inspecao_visual.batida === true){
              img_batida = "./Icons/true.png"
              cor_batida = "green"
          }
          if (ultima_lavagem.inspecao_visual.borda_danificada === true){
               img_borda = "./Icons/true.png"
              cor_borda = "green"
          }
          if (ultima_lavagem.inspecao_visual.risco === true){
               img_riscos = "./Icons/true.png"
              cor_riscos = "green"
          }
         
         console.log(img_batida)
         console.log(img_borda)
         console.log(img_riscos)
            
           
            cell1.innerHTML = '<img id="'+qtasrow+'" src="./Icons/play.png" onclick="mostraDisclosure()" width="20px" style=" cursor:pointer;">'
            cell2.innerHTML = '<div style="font-size:1em; cursor: pointer">'+dateFormat(ultima_lavagem.entrada_em,"dd/mm/yyyy - HH:MM:ss")+'hs</div>'
            cell3.innerHTML = '<div style="font-size:1em; cursor: pointer">'+lavagens[i].numero+' - '+lavagens[i].nome+'</div>'
            cell4.innerHTML = '<div><img src="'+img_batida+'" width="20px"></div>'
            cell5.innerHTML = '<img src="'+img_borda+'" width="20px">'
            cell6.innerHTML = '<img src="'+img_riscos+'" width="20px">'
            //cell4.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_borda+';border-radius:50%;display:inline-block"></span>'
           // cell5.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_batida+';border-radius:50%;display:inline-block"></span>'
            //cell6.innerHTML = '<span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_riscos+';border-radius:50%;display:inline-block"></span>'
            
            table = document.getElementById("tabela_pendencia_lavagens")
            qtasrow = table.rows.length
            
            var row2 =  table.insertRow(qtasrow);
            var cell1_2 = row2.insertCell(0);
            cell1_2.colSpan = 7
            cell1_2.style = "background-color: lightgray"
            cell1_2.style = "display: none;"
            cell1_2.innerHTML = '<div style="width: 40%; display:inline-block; vertical-align: top; padding-left: 20px; padding-top: 5px; marging-bottom: 5px;"><div style="width: 90%; display:inline-block; padding-top: 5px; marging-bottom: 5px;"><label for="tipo_lavagem">Tipo Lavagem</label><select id="select_'+lavagens[i]._id+'" class="form-control"><option value="undefined">Selecionar</option></select></div><div style="width: 90%; display:inline-block; padding-top: 5px; marging-bottom: 5px;"><button id="button_'+lavagens[i]._id+'" class="btn btn-primary" onclick="inicialavagem()">Iniciar Lavagem</button></div></div><div style="width: 60%; display:inline-block; vertical-align: top;"><strong>Observações:</strong><br><p>'+ultima_lavagem.inspecao_visual.observacoes+'</p></div>'
           
        
            qtasrow = qtasrow +1
            
            var selectTipoLavagem = document.getElementById("select_"+lavagens[i]._id)
            for (j=0;j<os_tipos_lavagem.length;j++){
             var opt = document.createElement('option');
        opt.value = os_tipos_lavagem[j].nome;
        opt.innerHTML = os_tipos_lavagem[j].nome;
        selectTipoLavagem.appendChild(opt);   
                
            }
            
    }
    
   	    }
  	        
  	    
  	</script>
  	<script>
  	    function salva_lavagem(){
  	         if (document.getElementById('os_anilox').value != undefined){
  	        var busca = api.custom_objects.list_with_options("BR-VALFI_anilox",["_id","equal to",document.getElementById('os_anilox').value]).results[0]
  	        document.getElementById("msg_salvar_anilox").innerText = "Anilox salvo com sucesso!"
  	        var altera = busca.lavagem
  	        var info = {}
  	      
  	        info["entrada_em"] = new Date()
  	        info["criado_por"] = usuario.fullname
  	        info["maquina"] = document.getElementById("maquina").value
  	        info["grupo_impressor"] = document.getElementById("grupo_impressor").value
  	        info["cor"] = document.getElementById("cor").value
  	        var info_visual = {}
  	        info_visual["batida"] = document.getElementById("Batida").checked
  	        info_visual["borda_danificada"] = document.getElementById("Borda Danificada").checked
  	        info_visual["risco"] = document.getElementById("Risco").checked
  	        info_visual["observacoes"] = document.getElementById("observacoes").value.trim()
  	        info["inspecao_visual"] = info_visual
  	        altera.push(info)
  	        
  	        api.custom_objects.set_keys("BR-VALFI_anilox",busca._id,{"lavagem":altera,"processo_lavagem": true,"status_lavagem":"Não Iniciado"})
  	        setTimeout(function(){
  	           $("#os_anilox").find('option').not(':first').remove();
  	          selectTipo = document.getElementById('os_anilox');
                var tiposTipo = api.custom_objects.list_with_options("BR-VALFI_anilox",["processo_lavagem","equal to",false]).results
                for (var i = 0; i<tiposTipo.length; i++){
                    var opt = document.createElement('option');
                    opt.value = tiposTipo[i]._id;
                    opt.innerHTML = tiposTipo[i].numero+" - "+tiposTipo[i].nome;
                    selectTipo.appendChild(opt);
               }
  	         document.getElementById("msg_salvar_anilox").innerText = ""
  	        document.getElementById('os_anilox').value = "undefined"
  	        document.getElementById("maquina").value = "undefined"
  	        document.getElementById("grupo_impressor").value = "undefined"
  	        document.getElementById("cor").value = ""
  	        document.getElementById("Batida").checked = false
  	        document.getElementById("Borda Danificada").checked = false
  	        document.getElementById("Risco").checked = false
  	        document.getElementById("observacoes").value = ""
  	       // document.getElementById("metragem").value = ""
  	        preenche_lista_pendente_lavagem()
  	         
  	       
  	        },2000)
  	        
  	         }
  	      
  	    }
  	    
  	    
  	      function  preenche_lista_em_execucao(){
  	        
  	     clearTable(document.getElementById("tabela_execucao_lavagens"))
          
          var lavagens = api.custom_objects.list_with_options("BR-VALFI_anilox",["processo_lavagem","equal to",true,"and","status_lavagem","equal to","Iniciado"]).results
         var table = document.getElementById("tabela_execucao_lavagens")
        var qtasrow = table.rows.length
      
            
            for (i=0;i<lavagens.length;i++){
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            
          var ultima_lavagem = lavagens[i].lavagem[lavagens[i].lavagem.length-1]
          
             
            
           
            cell1.innerHTML = '<img id="'+qtasrow+'" src="./Icons/ongoing.png" width="20px" onclick="mostraDisclosure2()" style=" cursor:pointer;">'
            cell2.innerHTML = '<div style="font-size:1em; cursor: pointer">'+dateFormat(ultima_lavagem.iniciada_em,"dd/mm/yyyy - HH:MM:ss")+'hs</div>'
            cell3.innerHTML = '<div style="font-size:1em; cursor: pointer">'+lavagens[i].numero+' - '+lavagens[i].nome+'</div>'
            cell4.innerHTML = '<div style="font-size:1em; cursor: pointer">'+ultima_lavagem.tipo+'</div>'
            cell5.innerHTML = '<div style="font-size:1em; cursor: pointer">'+ultima_lavagem.iniciada_por.fullname+'</div>'
            
            table = document.getElementById("tabela_execucao_lavagens")
            qtasrow = table.rows.length
            
            var row2 =  table.insertRow(qtasrow);
            var cell1_2 = row2.insertCell(0);
            cell1_2.colSpan = 7
            cell1_2.style = "background-color: lightgray"
            cell1_2.style = "display: none;"
            cell1_2.innerHTML = '<div style="width: 60%; display:inline-block; vertical-align: top; padding-left: 20px; padding-top: 5px; marging-bottom: 5px;"><div  class="form-group col-md-11"><p><strong>Conferência Visual pós Lavagem: </strong></p></div><div  class="form-group col-md-3" style="display:inline-block;"><input type="checkbox" class="form-group" id="Batida_pos" name="Batida_pos"><label for="Batida_pos">Batida</label></div><div  class="form-group col-md-5" style="display:inline-block;"><input type="checkbox" class="form-group"  id="Borda Danificada_pos" name="Borda Danificada_pos"><label for="Borda Danificada_pos">Borda Danificada</label></div><div  class="form-group col-md-3" style="display:inline-block;"><input type="checkbox" class="form-group"  id="Risco_pos" name="Risco_pos"><label for="Risco_pos">Risco</label></div></div>'
           
        
            qtasrow = qtasrow +1
            
           
            
    }
  	    }
  	</script>
  <script>
      
     function mostraEntrada(){
         
        var div_cliente = document.getElementById("info_entrada")
        var icone = document.getElementById("entradaArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            div_cliente.style.width = "100%";
            } else {
                div_cliente.style.display = "none";
            }
     
      }
      
      function mostraPendentes(){
         
        var div_cliente = document.getElementById("info_pendentes")
        var icone = document.getElementById("pendentesArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            div_cliente.style.width = "100%";
            preenche_lista_pendente_lavagem()
            } else {
                div_cliente.style.display = "none";
            }
     
      }
      
      function mostraExecucao(){
         
        var div_cliente = document.getElementById("info_execucao")
        var icone = document.getElementById("execucaoArrow")
        icone.classList.toggle("fa-chevron-down")
        if (div_cliente.style.display === "none") {
            div_cliente.style.display = "inline-block";
            div_cliente.style.width = "100%";
            preenche_lista_em_execucao()
            } else {
                div_cliente.style.display = "none";
            }
     
      }
      
  </script>
  <script>
      function mostra_outros(){
          if (document.getElementById("Outros").checked === true){
              document.getElementById("div_outros_valor").style = "display: inline-block; vertical-align: top"
          } else {
             document.getElementById("div_outros_valor").style = "display: none;"
             document.getElementById("outros_valor").value = ""
          }
      }
      
      
    function cria_grupo_impressor(){
        if (document.getElementById("maquina").value != "undefined"){
            $("#grupo_impressor").find('option').not(':first').remove();
        var busca_maquina = api.custom_objects.list_with_options("BR-VALFI_maquina",["nome","equal to",document.getElementById("maquina").value]).results[0]
        var qtde = parseInt(busca_maquina.cores)
        var numero = 1
        
        selectGrupo= document.getElementById('grupo_impressor');

        for (i=0;i<qtde;i++){
        console.log(numero)
        var valor = numero+i  
        var opt = document.createElement('option');
        opt.value = valor;
        opt.innerHTML = valor;
        selectGrupo.appendChild(opt);  
            
        }
            
        }
        
        
        
        
    }
  </script>
  <script>
      function mostraDisclosure(){
        var linha = parseInt(event.srcElement.id)+1
        var table = document.getElementById("tabela_pendencia_lavagens")
  
        if (table.rows[linha].children[0].style.display == "none"){
            table.rows[linha].children[0].style = "background-color: lightgray;"
            table.rows[linha].children[0].colSpan = 7
        } else {
            table.rows[linha].children[0].style = "display: none;" 
        }
      }
      
      
function inicialavagem(){
    var linha = event.srcElement.id
    var linha_array = linha.split("_")
    console.log(linha)
    var div_select = "select_"+linha_array[1]
    if (document.getElementById(div_select).value != "undefined"){
    var busca_anilox = api.custom_objects.list_with_options("BR-VALFI_anilox",["_id","equal to", linha_array[1]]).results
    if (busca_anilox.length == 1){
        console.log("achei o anilox")
        var as_lavagens  = busca_anilox[0].lavagem
        as_lavagens[as_lavagens.length-1]["iniciada_em"] = new Date()
        as_lavagens[as_lavagens.length-1]["iniciada_por"] = usuario
        as_lavagens[as_lavagens.length-1]["tipo"] = document.getElementById(div_select).value
        
        api.custom_objects.set_keys("BR-VALFI_anilox",busca_anilox[0]._id,{"lavagem":as_lavagens,"status_lavagem":"Iniciado"})
        preenche_lista_pendente_lavagem()
    }
    }
}
  </script>
  <script>
  $('#metragem').keypress(function(event){

       if(event.which != 8 && isNaN(String.fromCharCode(event.which))){
           event.preventDefault(); //stop character from entering input
       }

   });
   
   preenche_lista_pendente_lavagem()
   </script>
   <script>
       function cancela_lavagem(){
         document.getElementById("msg_salvar_anilox").innerText = ""
  	        document.getElementById('os_anilox').value = "undefined"
  	        document.getElementById("maquina").value = "undefined"
  	        document.getElementById("grupo_impressor").value = "undefined"
  	        document.getElementById("cor").value = ""
  	        document.getElementById("Batida").checked = false
  	        document.getElementById("Borda Danificada").checked = false
  	        document.getElementById("Risco").checked = false
  	        document.getElementById("observacoes").value = ""
  	     //   document.getElementById("metragem").value = ""
  	       setTimeout(function(){mostraEntrada()},1000) 
           
       }
   </script>
   <script>
         function mostraDisclosure2(){
        var linha = parseInt(event.srcElement.id)+1
        var table = document.getElementById("tabela_execucao_lavagens")
  
        if (table.rows[linha].children[0].style.display == "none"){
            table.rows[linha].children[0].style = "background-color: lightgray;"
            table.rows[linha].children[0].colSpan = 7
        } else {
            table.rows[linha].children[0].style = "display: none;" 
        }
      }
   </script>
  






    </body>

</html>