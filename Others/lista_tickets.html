<!doctype html>
<html>
    <head>
      <title>Tickets Abertos</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      
      <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/table.css">
        <meta name="viewport" content="width=944">
        <meta name="robots" content="noindex, follow">
	<link rel="Shortcut icon" href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/favicon.ico" type="image/x-icon">
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon.png" rel="apple-touch-icon" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
        <link href="/portal.cgi/PP_FILE_STORE/Sistema/assets/img/icons/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144" />
        <link rel="stylesheet" href="fonts/fontawesome-all.min.css">
        <link rel="stylesheet" href="fonts/font-awesome.min.css">
        <link rel="stylesheet" href="fonts/fontawesome5-overrides.min.css">
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.24/themes/smoothness/jquery-ui.css" />

        <script src="js/popper.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
          <script src="js/jscolor.js"></script>
    
        <script src="/portal.cgi/PP_FILE_STORE/Sistema/assets/js/vendor/modernizr-2.6.2.min.js"></script>
      	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-1.8.3.min.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-ui-1.9.2.custom.js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.cookie.js'></script>
    	<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js'></script>
    <!-- portal.js -->
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-linedtextarea.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/codemirror.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/javascript.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.tmpl.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery-regex.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/sitemapstyler.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/date.format.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.iframe-transport.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.fileupload.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.notify.min.js'></script>
    <!-- portal.js --> <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.event.drag-2.2.js'></script>
        <script type='text/javascript' src='/portal.cgi?api=js'></script>
    	<script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/portal/js/nixps-portal-api.js'></script>
        <script type='text/javascript' src='/portal.cgi/PP_FILE_STORE/Sistema/3rdParty/jquery.i18n.js'></script>
       
       
    

    </head>


    <body>

  		<div class="wrapper d-flex align-items-stretch">
  			<nav id="sidebar">
  				<div class="p-4 pt-5">
            <img>
  		  		<img src="./logo/logo_valgroup.png" style="width: 90%; margin-bottom: 50px;">
             <ul class="active components mb-5">
                  <li  style="color: #004b93; list-style-type: none">Tickets
                  <ul>
                       <li style="list-style-type: none">
                     <a href="solicitacao_desenho.html"><i class="fas fa-crosshairs" style="margin-right: 5px"></i>Novo Ticket</a>
                    </li>
                 <li class="active" style="list-style-type: none">
                     <a href="lista_tickets.html"><i class="fas fa-th-list" style="margin-right: 5px"></i>Lista Tickets</a>
                    </li>
                     
                    </ul>
                </ul>
             
                    
       
   
  	        <div class="footer">
  	        	<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0.
  						  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
  						   Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
  	        </div>
  	      </div>
      	</nav>

          <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">

              <button type="button" id="sidebarCollapse" class="btn btn-primary">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
              </button>
              <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars"></i>
              </button>
              <div id="bemvindo" style="margin-left: 20px;"></div>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav ml-auto">
                 <li class="nav-item">
                      <a class="nav-link" href="cadastros_clientes.html">Cadastros</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="solicitacao_desenho.html">Tickets</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="alterar_senha.html" target="_Blank">Alterar Senha</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
          <div>
        <h4 style="display:inline-block;">Lista Prioridades</h4>
        
        <table id="tabela_prioridades" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%" style="display: inline-block">
          <thead>
            <tr>
             
             
              <th class="th-sm" style="width:15%; vertical-align: top;">Hora Est.Inicio
              </th>
              <th class="th-sm" style="width:14%">Cliente
              
              </th>
              <th class="th-sm" style="width:20%">Descrição
              
              </th>
              <th class="th-sm" style="width:10%">Tipo
              </th>
              <th class="th-sm" style="width:10%">Comercial
              </th>
              <th class="th-sm" style="width:5%;vertical-align: top;">Iniciar
              </th>
              <th class="th-sm" style="width:5%;vertical-align: top;">Pause
              </th>
              <th class="th-sm" style="width:5%;vertical-align: top;">Finalizar
              </th>
              
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        
        <br>
        
        
         <h4 style="display:inline-block;">Aguardando Liberação</h4>
        <br>
        <table id="tabela_aguardando" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%" style="display: inline-block">
          <thead>
            <tr>
             
             
              <th class="th-sm" style="width:15%; vertical-align: top;">Criado em<i id="criado_em" class="fa fa-caret-down" style="cursor:pointer; margin-left: 5px;" onclick="sort_aguardando()"></i>
              </th>
              <th class="th-sm" style="width:14%">Cliente<i id="cliente" class="fa fa-caret-right" style="cursor:pointer; margin-left: 5px;" onclick="sort_aguardando()"></i><br><span style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_cliente" class="form-control" type="text" onkeyup="filtro_cliente()"></span>
              </th>
              <th class="th-sm" style="width:20%">Descrição<i id="descricao" class="fa fa-caret-right" style="cursor:pointer; margin-left: 5px;" onclick="sort_aguardando()"></i><br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_descricao" class="form-control" type="text" onkeyup="filtro_descricao()"></span>
              </th>
              <th class="th-sm" style="width:10%">Tipo<i id="tipo_trabalho" class="fa fa-caret-right" style="cursor:pointer; margin-left: 5px;" onclick="sort_aguardando()"></i><br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_tipo" class="form-control" type="text" onkeyup="filtro_tipo()"></span>
              </th>
              <th class="th-sm" style="width:10%">Comercial<i id="responsavel_comercial" class="fa fa-caret-right" style="cursor:pointer; margin-left: 5px;" onclick="sort_aguardando()"></i><br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_comercial" class="form-control" type="text" onkeyup="filtro_comercial()"></span>
              </th>
              <th class="th-sm" style="width:7%;vertical-align: top;">Arte OK
              </th>
              <th class="th-sm" style="width:7%;vertical-align: top;">Ref. Cor
              </th>
              <th class="th-sm" style="width:7%;vertical-align: top;">Espec.
              </th>
              <th class="th-sm" style="width:5%;vertical-align: top;">Priorizar<!--<br><span  style="margin-left: 5px; display: inline-block; vertical-align: top;"><input id="input_nomelocal" type="text" onkeyup="filtro_localtarja()"></span>-->
              </th>
              
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        
       
        
     
            
            <!-- terminar mostra locais e começa mostra registro -->
            
          
          
           
                <br>
               
              
            </div>
        
       
  	
  		
  	
  	<script>
  	    // funcoes de apoio
  	    
  	    var usuario = api.auth.get_current_user()
  	    
  	    document.getElementById("bemvindo").innerText = "Bem vindo, "+usuario.fullname
  	    
      function clearTable(table) {
  var rows = table.rows;
  var i = rows.length;
  while (--i) {
    rows[i].parentNode.removeChild(rows[i]);
    // or
    // table.deleteRow(i);
  }
}

function onlyUnique(value, index, self) {
  return self.indexOf(value) === index;
}



// preenche dados se existe ordem

</script>
<script>
     function preenche_aguardando(sorting){
  	        
  	     clearTable(document.getElementById("tabela_aguardando"))
  	     
  	     var listar_por = []
  	     if (sorting === undefined){
  	         listar_por.push("criado_em")
  	         listar_por.push("ascending")
  	     } else {
  	         listar_por.push(sorting)
  	         listar_por.push("ascending")
  	     }
  	     
         
         var busca_tickets = api.custom_objects.list_with_options("BR-VALFI_Tickets",["priorizado","equal to",false],listar_por).results
          
         var table = document.getElementById("tabela_aguardando")
        var qtasrow = table.rows.length
      
            
            for (i=0;i<busca_tickets.length;i++){
            var row =  table.insertRow(qtasrow);
            
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            var cell9 = row.insertCell(8);
            
          
           var a_data = dateFormat(busca_tickets[i].criado_em,"dd/mm/yyyy - HH:MM")
            
            var cor_arte = "red"
            if (busca_tickets[i].checklist_ticket_entrada["Arte OK"] === true){
                cor_arte = "#00FF00"
            }
            var cor_ref = "red"
            console.log(busca_tickets[i].checklist_ticket_entrada["Referencia de Cor"])
            if (busca_tickets[i].checklist_ticket_entrada["Referencia de Cor"] === true){
                cor_ref = "#00FF00"
            }
            var cor_espec = "red"
            if (busca_tickets[i].checklist_ticket_entrada["Especificacao"] === true){
                cor_espec = "#00FF00"
            }
            
           
            
            cell1.innerHTML = '<div style="font-size:1em;">'+a_data+'hs</div>'
            cell2.innerHTML = '<div style="font-size:1em;">'+busca_tickets[i].cliente+'</div>'
            cell3.innerHTML = '<div style="font-size:1em;"><a href="editar_ticket.html?ordem='+busca_tickets[i]._id+'" target="_Blank">'+busca_tickets[i].descricao+'</a></div>'
            cell4.innerHTML = '<div style="font-size:1em;">'+busca_tickets[i].tipo_trabalho+'</div>'
            cell5.innerHTML = '<div style="font-size:1em;">'+busca_tickets[i].responsavel_comercial+'</div>'
            cell6.innerHTML = '<div style="font-size:1em;"><span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_arte+';border-radius:50%;display:inline-block"></span></div>'
          
           cell7.innerHTML = '<div style="font-size:1em;"><span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_ref+';border-radius:50%;display:inline-block"></span></div>'
           cell8.innerHTML = '<div style="font-size:1em;"><span style="margin-top:5px;height:20px;width:20px;background-color:'+cor_espec+';border-radius:50%;display:inline-block"></span></div>'
           cell9.innerHTML = '<div style="font-size:1em; cursor: pointer"><img src="./Icons/priority.png" width="40px" id="'+busca_tickets[i]._id+'" onclick="priorizar()"></div>'
            
            qtasrow = qtasrow +1
      
      
        
        
    }
  	   
  	   preenche_prioridades()
  	    }
  	    
  	    
  	 function priorizar(){
  	     var linha = event.srcElement.id
  	    
  	     var existe_prioridade = api.custom_objects.list_with_options("BR-VALFI_Tickets",["priorizado","equal to",true,"and","arte_finalizado","equal to",false],["hora_estimada.final","ascending"]).results 
  	     if (existe_prioridade.length < 2){
  	      var inicio = new Date()
  	      var info_inicio = {}
  	      if (inicio.getHours() > 12){
  	      inicio.setDate(inicio.getDate()+1)
  	      info_inicio["inicio"] = new Date(inicio.setHours(8,0,0,0))
  	      } else {
  	        info_inicio["inicio"] = new Date(inicio.setHours(13,0,0,0))  
  	      }
  	      info_inicio["final"] = new Date(inicio.setHours(inicio.getHours()+4))
  	     console.log(info_inicio)
  	      api.custom_objects.set_keys("BR-VALFI_Tickets",linha,{"priorizado": true,"hora_estimada":info_inicio})
  	      var buscaID = api.custom_objects.list_with_options("BR-VALFI_Tickets",["_id","equal to",linha]).results[0]
  	      lista_prioridades.push(buscaID)
  	      preenche_aguardando("criado_em")
  	     } else {
  	        var ultima_hora = new Date(existe_prioridade[existe_prioridade.length-1].hora_estimada.final)
  	        
  	        var busca_quantos = api.custom_objects.list_with_options("BR-VALFI_Tickets",["hora_estimada.final","equal to",ultima_hora,"and","arte_finalizado","equal to",false]).results
  	        
  	        if (busca_quantos.length > 1){
  	          var info_inicio = {}
  	          if (ultima_hora < 13){
  	              info_inicio["inicio"] = new Date(ultima_hora.setHours(13,0,0,0))
  	          } else {
  	              ultima_hora.setDate(ultima_hora.getDate()+1)
  	              info_inicio["inicio"] = new Date(ultima_hora.setHours(8,0,0,0))
  	          }
  	          info_inicio["final"] = new Date(ultima_hora.setHours(ultima_hora.getHours()+4))
  	          api.custom_objects.set_keys("BR-VALFI_Tickets",linha,{"priorizado": true,"hora_estimada":info_inicio})
  	      
  	            
  	        } else {
  	            if (busca_quantos.length === 1){
  	            api.custom_objects.set_keys("BR-VALFI_Tickets",linha,{"priorizado": true,"hora_estimada":busca_quantos[0].hora_estimada})
  	            }
  	       
  	        }
  	        
  	        var buscaID = api.custom_objects.list_with_options("BR-VALFI_Tickets",["_id","equal to",linha]).results[0]
  	         lista_prioridades.push(buscaID)
  	        preenche_aguardando("criado_em")
  	       
  	     } 
  	         
  	     
  	 }
  	    
  
</script>
<script>
    var lista_prioridades = []
    var busca_prioridades = api.custom_objects.list_with_options("BR-VALFI_Tickets",["priorizado","equal to",true]).results
    for (i=0;i<busca_prioridades.length;i++){
        lista_prioridades.push(busca_prioridades[i])
    }
    
    
     function preenche_prioridades(){
  	        
  	     clearTable(document.getElementById("tabela_prioridades"))
  	     
  	     
         var table = document.getElementById("tabela_prioridades")
        var qtasrow = table.rows.length
      
            
            for (i=0;i<lista_prioridades.length;i++){
            var row =  table.insertRow(qtasrow);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            
          
           var a_data = dateFormat(lista_prioridades[i].hora_estimada.inicio,"dd/mm/yyyy - HH:MM")
            
           
           
            
            cell1.innerHTML = '<div style="font-size: 1em; display: inline-block;"><div style="display:inline-block"><i onclick="move_acima()" id="'+i+'" class="fas fa-arrow-up" style="margin-right: 5px; cursor: pointer;"></i><i  onclick="move_abaixo()" id="'+i+'" class="fas fa-arrow-down" style="margin-right: 5px;cursor: pointer;"></i><div style="font-size:1em; display: inline-block;">'+a_data+'hs</div>'
            cell2.innerHTML = '<div style="font-size:1em;">'+lista_prioridades[i].cliente+'</div>'
            cell3.innerHTML = '<div style="font-size:1em;"><a href="editar_ticket.html?ordem='+lista_prioridades[i]._id+'" target="_Blank">'+lista_prioridades[i].descricao+'</a></div>'
            cell4.innerHTML = '<div style="font-size:1em;">'+lista_prioridades[i].tipo_trabalho+'</div>'
            cell5.innerHTML = '<div style="font-size:1em;">'+lista_prioridades[i].responsavel_comercial+'</div>'
           cell6.innerHTML = '<div style="font-size:1em; cursor: pointer"><img src="./Icons/play.png" width="40px" id="'+lista_prioridades[i]._id+'" onclick="priorizar()"></div>'
           cell7.innerHTML = '<div style="font-size:1em; cursor: pointer"><img src="./Icons/pause.png" width="40px" id="'+lista_prioridades[i]._id+'" onclick="priorizar()"></div>'
           
           cell8.innerHTML = '<div style="font-size:1em; cursor: pointer"><img src="./Icons/stop.png" width="40px" id="'+lista_prioridades[i]._id+'" onclick="priorizar()"></div>'
            
            qtasrow = qtasrow +1
      
      
        
        
    }
  	    }
    
    	    preenche_aguardando("criado_em")
</script>

    


  	
  
  
  	
  






    </body>

</html>